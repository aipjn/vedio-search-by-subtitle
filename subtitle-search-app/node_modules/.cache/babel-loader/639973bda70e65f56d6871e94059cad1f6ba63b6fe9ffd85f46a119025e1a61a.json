{"ast":null,"code":"import React,{useState,useEffect}from'react';import'./App.css';import axios from'axios';// 子页面组件\nimport{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const SearchPage=_ref=>{let{API_BASE_URL,query,setQuery,searchResults,setSearchResults,loading,setLoading,apiStatus,error,setError,selectedResult,setSelectedResult,videoUrl,setVideoUrl,isVideoLoading,setIsVideoLoading,handleSearch,handleGenerateClip,formatTime,formatEpisode,highlightText}=_ref;return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"section\",{className:\"search-area\",children:[/*#__PURE__*/_jsx(\"form\",{onSubmit:handleSearch,children:/*#__PURE__*/_jsxs(\"div\",{className:\"search-box\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:query,onChange:e=>setQuery(e.target.value),placeholder:\"\\u8F93\\u5165\\u8981\\u641C\\u7D22\\u7684\\u5B57\\u5E55\\u5185\\u5BB9...\",disabled:apiStatus!=='connected'}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:loading||apiStatus!=='connected',children:loading?'搜索中...':'搜索'})]})}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"error-message\",children:error})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"content-area\",children:[/*#__PURE__*/_jsxs(\"section\",{className:\"results-area\",children:[/*#__PURE__*/_jsxs(\"h2\",{children:[\"\\u641C\\u7D22\\u7ED3\\u679C \",searchResults.length>0&&`(${searchResults.length})`]}),loading?/*#__PURE__*/_jsx(\"div\",{className:\"loading\",children:\"\\u641C\\u7D22\\u4E2D\\uFF0C\\u8BF7\\u7A0D\\u5019...\"}):/*#__PURE__*/_jsx(\"ul\",{className:\"results-list\",children:searchResults.map((result,index)=>/*#__PURE__*/_jsxs(\"li\",{className:selectedResult===result?'selected':'',onClick:()=>handleGenerateClip(result),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"result-header\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"episode\",children:formatEpisode(result.episode)}),/*#__PURE__*/_jsxs(\"span\",{className:\"time\",children:[formatTime(result.start_seconds),\" - \",formatTime(result.end_seconds)]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"subtitle-text\",dangerouslySetInnerHTML:{__html:highlightText(result.text,query)}})]},index))})]}),/*#__PURE__*/_jsxs(\"section\",{className:\"video-area\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\u89C6\\u9891\\u64AD\\u653E\"}),selectedResult?/*#__PURE__*/_jsxs(\"div\",{className:\"video-player\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"video-info\",children:[/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\u96C6\\u6570:\"}),\" \",formatEpisode(selectedResult.episode)]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\u65F6\\u95F4\\u6BB5:\"}),\" \",formatTime(selectedResult.start_seconds),\" - \",formatTime(selectedResult.end_seconds)]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\u5B57\\u5E55\\u5185\\u5BB9:\"}),\" \",selectedResult.text]})]}),isVideoLoading?/*#__PURE__*/_jsx(\"div\",{className:\"loading-video\",children:\"\\u751F\\u6210\\u89C6\\u9891\\u7247\\u6BB5\\u4E2D\\uFF0C\\u8BF7\\u7A0D\\u5019...\"}):videoUrl?/*#__PURE__*/_jsx(\"video\",{controls:true,autoPlay:true,className:\"video-element\",src:videoUrl}):/*#__PURE__*/_jsx(\"div\",{className:\"video-placeholder\",children:selectedResult?'准备生成视频片段...':'请从左侧选择一个搜索结果'})]}):/*#__PURE__*/_jsx(\"div\",{className:\"video-placeholder\",children:\"\\u8BF7\\u4ECE\\u5DE6\\u4FA7\\u9009\\u62E9\\u4E00\\u4E2A\\u641C\\u7D22\\u7ED3\\u679C\"})]})]})]});};// 成语接龙游戏组件\nconst ChainGamePage=_ref2=>{let{API_BASE_URL,apiStatus,formatTime,formatEpisode}=_ref2;const[gameStarted,setGameStarted]=useState(false);const[currentPrompts,setCurrentPrompts]=useState([]);const[loadingPrompts,setLoadingPrompts]=useState(false);const[gameLog,setGameLog]=useState([]);const[currentSentence,setCurrentSentence]=useState(null);const[nextOptions,setNextOptions]=useState([]);const[loadingNextOptions,setLoadingNextOptions]=useState(false);const[gameError,setGameError]=useState(null);const[videoUrl,setVideoUrl]=useState('');const[isVideoLoading,setIsVideoLoading]=useState(false);const[selectedOption,setSelectedOption]=useState(null);const[isExportingVideo,setIsExportingVideo]=useState(false);const[clipUrls,setClipUrls]=useState([]);const[isConfirmMode,setIsConfirmMode]=useState(false);// 获取随机提示句子\nconst fetchRandomPrompts=async()=>{setLoadingPrompts(true);setGameError(null);try{const response=await axios.get(`${API_BASE_URL}/api/random_sentences`,{params:{count:8}});if(response.data&&response.data.sentences){setCurrentPrompts(response.data.sentences);}else{setGameError('获取提示句子失败');}}catch(error){console.error('获取提示句子错误:',error);setGameError('无法获取提示句子，请确保API服务正常运行');}finally{setLoadingPrompts(false);}};// 刷新随机提示\nconst refreshRandomPrompts=()=>{if(apiStatus==='connected'&&!loadingPrompts){fetchRandomPrompts();}};// 开始新游戏\nconst startNewGame=()=>{setGameLog([]);fetchRandomPrompts();setGameStarted(false);setCurrentSentence(null);setNextOptions([]);setClipUrls([]);setVideoUrl('');setSelectedOption(null);setIsConfirmMode(false);};// 生成视频片段\nconst generateVideoClip=async subtitle=>{setIsVideoLoading(true);setVideoUrl('');setGameError(null);try{const response=await axios.post(`${API_BASE_URL}/api/generate_clip`,{episode:subtitle.episode,start_time:subtitle.start_seconds,end_time:subtitle.end_seconds,context_seconds:2});if(response.data.success){setVideoUrl(`${API_BASE_URL}${response.data.video_url}`);return`${API_BASE_URL}${response.data.video_url}`;}else{setGameError('生成视频片段失败');return null;}}catch(error){console.error('生成视频片段出错:',error);setGameError('视频服务出现错误，请确保视频文件存在且可访问');return null;}finally{setIsVideoLoading(false);}};// 选择开始句子\nconst selectStartSentence=async sentence=>{setSelectedOption(sentence);setIsConfirmMode(true);const clipUrl=await generateVideoClip(sentence);if(!clipUrl)return;};// 确认选择开始句子\nconst confirmStartSentence=()=>{const sentence=selectedOption;if(!sentence)return;setCurrentSentence(sentence);setGameLog([{...sentence,step:1,clipUrl:videoUrl}]);setClipUrls([...clipUrls,videoUrl]);setGameStarted(true);fetchNextOptions(sentence.text);setIsConfirmMode(false);setSelectedOption(null);};// 取消选择\nconst cancelSelection=()=>{setIsConfirmMode(false);setSelectedOption(null);setVideoUrl('');};// 获取下一步选项\nconst fetchNextOptions=async text=>{if(!text)return;setLoadingNextOptions(true);setGameError(null);try{// 获取最后一个字，排除语气词\nlet lastChar=getLastValidChar(text);if(!lastChar){setGameError('无法识别有效的结尾字符');setLoadingNextOptions(false);return;}const response=await axios.get(`${API_BASE_URL}/api/search`,{params:{query:`^${lastChar}`,use_regex:true}});if(response.data&&response.data.results){// 过滤结果，保留3-8个字的句子\nconst filteredResults=response.data.results.filter(item=>{const cleanText=item.text.replace(/[啊呢吗吧呀嘛哦哎嗯呐呵呦诶哈哟]$/,'');return cleanText.length>=3&&cleanText.length<=8;});// 随机选择最多8个结果\nconst shuffled=[...filteredResults].sort(()=>0.5-Math.random());setNextOptions(shuffled.slice(0,8));if(shuffled.length===0){setGameError('没有找到符合条件的接续句子');}}else{setGameError('获取接续句子失败');}}catch(error){console.error('获取接续句子错误:',error);setGameError('无法获取接续句子，请确保API服务正常运行');}finally{setLoadingNextOptions(false);}};// 获取最后一个有效字符（排除语气词）\nconst getLastValidChar=text=>{if(!text||text.length===0)return null;// 排除常见语气词\nconst cleanText=text.replace(/[啊呢吗吧呀嘛哦哎嗯呐呵呦诶哈哟]$/,'');return cleanText.length>0?cleanText[cleanText.length-1]:null;};// 刷新下一步选项\nconst refreshNextOptions=()=>{if(currentSentence&&!loadingNextOptions){fetchNextOptions(currentSentence.text);}};// 选择下一个句子\nconst selectNextSentence=async sentence=>{setSelectedOption(sentence);setIsConfirmMode(true);const clipUrl=await generateVideoClip(sentence);if(!clipUrl)return;};// 确认选择下一个句子\nconst confirmNextSentence=()=>{const sentence=selectedOption;if(!sentence)return;setCurrentSentence(sentence);setGameLog([...gameLog,{...sentence,step:gameLog.length+1,clipUrl:videoUrl}]);setClipUrls([...clipUrls,videoUrl]);fetchNextOptions(sentence.text);setIsConfirmMode(false);setSelectedOption(null);};// 回到上一步\nconst goBackOneStep=()=>{if(gameLog.length<=1){// 只有一步，回到选择开始句子\nsetGameStarted(false);setGameLog([]);setCurrentSentence(null);setNextOptions([]);setClipUrls([]);return;}// 删除最后一步\nconst newLog=gameLog.slice(0,-1);const newClipUrls=clipUrls.slice(0,-1);setGameLog(newLog);setClipUrls(newClipUrls);setCurrentSentence(newLog[newLog.length-1]);fetchNextOptions(newLog[newLog.length-1].text);};// 导出合并视频\nconst exportMergedVideo=async()=>{// 只从gameLog中获取选中的视频URL，而不是使用clipUrls\nconst selectedClipUrls=gameLog.map(entry=>entry.clipUrl).filter(url=>url);if(selectedClipUrls.length===0){setGameError('没有可导出的视频');return;}setIsExportingVideo(true);setGameError(null);try{const response=await axios.post(`${API_BASE_URL}/api/merge_clips`,{clip_urls:selectedClipUrls});if(response.data.success){// 触发下载\nconst a=document.createElement('a');a.href=`${API_BASE_URL}${response.data.merged_video_url}`;a.download='甄嬛传接龙.mp4';document.body.appendChild(a);a.click();document.body.removeChild(a);}else{setGameError('导出视频失败');}}catch(error){console.error('导出视频错误:',error);setGameError('导出视频失败，请确保服务器正常运行');}finally{setIsExportingVideo(false);}};// 初始加载时获取随机提示\nuseEffect(()=>{if(apiStatus==='connected'){fetchRandomPrompts();}},[apiStatus]);return/*#__PURE__*/_jsxs(\"div\",{className:\"chain-game-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"game-controls\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:startNewGame,className:\"new-game-btn\",disabled:apiStatus!=='connected',children:\"\\u65B0\\u6E38\\u620F\"}),gameStarted&&/*#__PURE__*/_jsx(\"button\",{onClick:goBackOneStep,className:\"back-btn\",disabled:gameLog.length===0,children:\"\\u4E0A\\u4E00\\u6B65\"}),clipUrls.length>1&&/*#__PURE__*/_jsx(\"button\",{onClick:exportMergedVideo,className:\"export-btn\",disabled:isExportingVideo,children:isExportingVideo?'导出中...':'导出接龙视频'})]}),gameError&&/*#__PURE__*/_jsx(\"div\",{className:\"error-message\",children:gameError}),/*#__PURE__*/_jsxs(\"div\",{className:\"game-content\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"game-candidates\",children:[!gameStarted?/*#__PURE__*/_jsxs(\"div\",{className:\"start-game-section\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"section-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\u9009\\u62E9\\u5F00\\u59CB\\u53E5\\u5B50\"}),/*#__PURE__*/_jsx(\"button\",{onClick:refreshRandomPrompts,className:\"refresh-btn\",disabled:loadingPrompts||apiStatus!=='connected',children:\"\\u6362\\u4E00\\u6279\"})]}),loadingPrompts?/*#__PURE__*/_jsx(\"div\",{className:\"loading\",children:\"\\u52A0\\u8F7D\\u63D0\\u793A\\u53E5\\u5B50\\u4E2D...\"}):/*#__PURE__*/_jsx(\"ul\",{className:\"prompts-list\",children:currentPrompts.map((prompt,index)=>/*#__PURE__*/_jsxs(\"li\",{onClick:()=>selectStartSentence(prompt),className:selectedOption===prompt?'prompt-item selected':'prompt-item',children:[/*#__PURE__*/_jsx(\"div\",{className:\"prompt-text\",children:prompt.text}),/*#__PURE__*/_jsxs(\"div\",{className:\"prompt-info\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"episode\",children:formatEpisode(prompt.episode)}),/*#__PURE__*/_jsx(\"span\",{className:\"time\",children:formatTime(prompt.start_seconds)})]})]},index))}),currentPrompts.length===0&&!loadingPrompts&&/*#__PURE__*/_jsxs(\"div\",{className:\"no-prompts\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"\\u6CA1\\u6709\\u53EF\\u7528\\u7684\\u63D0\\u793A\\u53E5\\u5B50\"}),/*#__PURE__*/_jsx(\"button\",{onClick:fetchRandomPrompts,disabled:apiStatus!=='connected',children:\"\\u91CD\\u65B0\\u83B7\\u53D6\"})]})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"current-section\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\u5F53\\u524D\\u53E5\\u5B50\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"current-sentence\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"current-text\",children:currentSentence===null||currentSentence===void 0?void 0:currentSentence.text}),/*#__PURE__*/_jsxs(\"div\",{className:\"current-info\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"episode\",children:formatEpisode(currentSentence===null||currentSentence===void 0?void 0:currentSentence.episode)}),/*#__PURE__*/_jsx(\"span\",{className:\"time\",children:formatTime(currentSentence===null||currentSentence===void 0?void 0:currentSentence.start_seconds)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"next-hint\",children:[\"\\u4E0B\\u4E00\\u53E5\\u9700\\u4EE5\\u300C\",getLastValidChar(currentSentence===null||currentSentence===void 0?void 0:currentSentence.text),\"\\u300D\\u5B57\\u5F00\\u5934\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"next-options-section\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"section-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\u53EF\\u9009\\u63A5\\u7EED\"}),/*#__PURE__*/_jsx(\"button\",{onClick:refreshNextOptions,className:\"refresh-btn\",disabled:loadingNextOptions,children:\"\\u6362\\u4E00\\u6279\"})]}),loadingNextOptions?/*#__PURE__*/_jsx(\"div\",{className:\"loading\",children:\"\\u52A0\\u8F7D\\u63A5\\u7EED\\u53E5\\u5B50\\u4E2D...\"}):/*#__PURE__*/_jsx(\"ul\",{className:\"options-list\",children:nextOptions.map((option,index)=>/*#__PURE__*/_jsxs(\"li\",{onClick:()=>selectNextSentence(option),className:selectedOption===option?'option-item selected':'option-item',children:[/*#__PURE__*/_jsx(\"div\",{className:\"option-text\",children:option.text}),/*#__PURE__*/_jsxs(\"div\",{className:\"option-info\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"episode\",children:formatEpisode(option.episode)}),/*#__PURE__*/_jsx(\"span\",{className:\"time\",children:formatTime(option.start_seconds)})]})]},index))}),nextOptions.length===0&&!loadingNextOptions&&/*#__PURE__*/_jsxs(\"div\",{className:\"no-options\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"\\u6CA1\\u6709\\u627E\\u5230\\u5408\\u9002\\u7684\\u63A5\\u7EED\\u53E5\\u5B50\"}),/*#__PURE__*/_jsx(\"button\",{onClick:startNewGame,children:\"\\u91CD\\u65B0\\u5F00\\u59CB\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"game-log-section\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\u63A5\\u9F99\\u8BB0\\u5F55\"}),gameLog.length>0?/*#__PURE__*/_jsx(\"ol\",{className:\"game-log-list\",children:gameLog.map((log,index)=>/*#__PURE__*/_jsxs(\"li\",{className:\"log-item\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"log-text\",children:log.text}),/*#__PURE__*/_jsxs(\"div\",{className:\"log-info\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"episode\",children:formatEpisode(log.episode)}),/*#__PURE__*/_jsx(\"span\",{className:\"time\",children:formatTime(log.start_seconds)}),log.clipUrl&&/*#__PURE__*/_jsx(\"span\",{className:\"clip-info\",children:/*#__PURE__*/_jsx(\"i\",{className:\"video-icon\",children:\"\\uD83C\\uDFAC\"})})]})]},index))}):/*#__PURE__*/_jsx(\"div\",{className:\"empty-log\",children:\"\\u5C1A\\u672A\\u5F00\\u59CB\\u6E38\\u620F\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"game-video-preview\",children:[isConfirmMode&&/*#__PURE__*/_jsxs(\"div\",{className:\"confirm-section\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"selected-sentence\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"selected-text\",children:selectedOption===null||selectedOption===void 0?void 0:selectedOption.text}),/*#__PURE__*/_jsxs(\"div\",{className:\"selected-info\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"episode\",children:formatEpisode(selectedOption===null||selectedOption===void 0?void 0:selectedOption.episode)}),/*#__PURE__*/_jsx(\"span\",{className:\"time\",children:formatTime(selectedOption===null||selectedOption===void 0?void 0:selectedOption.start_seconds)})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"video-preview\",children:isVideoLoading?/*#__PURE__*/_jsx(\"div\",{className:\"loading-video\",children:\"\\u751F\\u6210\\u89C6\\u9891\\u7247\\u6BB5\\u4E2D\\uFF0C\\u8BF7\\u7A0D\\u5019...\"}):videoUrl?/*#__PURE__*/_jsx(\"video\",{controls:true,autoPlay:true,className:\"video-element\",src:videoUrl}):/*#__PURE__*/_jsx(\"div\",{className:\"video-placeholder\",children:\"\\u51C6\\u5907\\u751F\\u6210\\u89C6\\u9891\\u7247\\u6BB5...\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"confirm-actions\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:gameStarted?confirmNextSentence:confirmStartSentence,className:\"confirm-btn\",disabled:!videoUrl||isVideoLoading,children:\"\\u786E\\u8BA4\\u9009\\u62E9\"}),/*#__PURE__*/_jsx(\"button\",{onClick:cancelSelection,className:\"cancel-btn\",children:\"\\u53D6\\u6D88\\u9009\\u62E9\"})]})]}),!isConfirmMode&&/*#__PURE__*/_jsx(\"div\",{className:\"video-placeholder large\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"placeholder-text\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"\\u8BF7\\u4ECE\\u5DE6\\u4FA7\\u9009\\u62E9\\u4E00\\u4E2A\\u53E5\\u5B50\"}),/*#__PURE__*/_jsx(\"p\",{children:\"\\u9009\\u62E9\\u540E\\u5C06\\u5728\\u6B64\\u5904\\u9884\\u89C8\\u89C6\\u9891\"})]})})]})]})]});};function App(){const[query,setQuery]=useState('');const[results,setResults]=useState([]);const[loading,setLoading]=useState(false);const[error,setError]=useState('');const[selectedResult,setSelectedResult]=useState(null);const[videoUrl,setVideoUrl]=useState('');const[apiStatus,setApiStatus]=useState({loading:true,error:null,data:null});const[activePage,setActivePage]=useState('search');// 'search' 或 'chain-game'\n// API 相关配置\nconst API_BASE_URL='http://localhost:8089';// 检查API状态\nuseEffect(()=>{const checkApiStatus=async()=>{try{const response=await fetch(`${API_BASE_URL}/api/status`);if(response.ok){const data=await response.json();setApiStatus({loading:false,error:null,data});console.log(\"API状态:\",data);}else{setApiStatus({loading:false,error:'无法连接到API服务',data:null});}}catch(error){console.error(\"API连接错误:\",error);setApiStatus({loading:false,error:'无法连接到API服务',data:null});}};checkApiStatus();},[]);const handleSearch=async e=>{e.preventDefault();if(!query.trim()){setError('请输入搜索内容');return;}setLoading(true);setError('');setResults([]);setSelectedResult(null);setVideoUrl('');try{// 构建查询URL\nconst queryParams=new URLSearchParams({query:query.trim()}).toString();const response=await fetch(`${API_BASE_URL}/api/search?${queryParams}`);if(response.ok){const data=await response.json();setResults(data.results||[]);if(data.results&&data.results.length===0){setError('没有找到匹配的结果');}}else{const errorData=await response.json();setError(errorData.error||'搜索失败');}}catch(error){console.error('搜索失败:',error);setError('搜索请求失败，请检查网络连接');}finally{setLoading(false);}};const handleGenerateClip=async result=>{if(!result)return;setSelectedResult(result);setLoading(true);setError('');setVideoUrl('');try{const response=await fetch(`${API_BASE_URL}/api/generate_clip`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({episode:result.episode,start_time:result.start_seconds,end_time:result.end_seconds,context_seconds:3// 上下文秒数\n})});if(response.ok){const data=await response.json();if(data.success){// 确保视频URL包含完整的基础URL\nconst fullVideoUrl=data.video_url.startsWith('http')?data.video_url:`${API_BASE_URL}${data.video_url}`;setVideoUrl(fullVideoUrl);}else{setError(data.error||'视频片段生成失败');}}else{const errorData=await response.json();setError(errorData.error||'请求失败');}}catch(error){console.error('生成视频片段失败:',error);setError('请求失败，请检查网络连接');}finally{setLoading(false);}};// 格式化时间显示\nconst formatTime=seconds=>{if(seconds===undefined||seconds===null)return'00:00:00';const hours=Math.floor(seconds/3600);const mins=Math.floor(seconds%3600/60);const secs=Math.floor(seconds%60);return`${hours.toString().padStart(2,'0')}:${mins.toString().padStart(2,'0')}:${secs.toString().padStart(2,'0')}`;};// 格式化集数显示\nconst formatEpisode=episode=>{if(!episode)return'';return episode.replace('后宫·甄嬛传','第')+'集';};// 高亮显示匹配文本\nconst highlightText=(text,query)=>{if(!query||!text)return text;try{const regex=new RegExp(query,'gi');return text.replace(regex,match=>`<mark>${match}</mark>`);}catch(e){return text;}};// 切换页面\nconst switchPage=page=>{setActivePage(page);};return/*#__PURE__*/_jsxs(\"div\",{className:\"App\",children:[/*#__PURE__*/_jsxs(\"header\",{className:\"App-header\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"\\u300A\\u540E\\u5BAB\\xB7\\u7504\\u5B1B\\u4F20\\u300B\\u5B57\\u5E55\\u641C\\u7D22\\u7CFB\\u7EDF\"}),apiStatus.loading&&/*#__PURE__*/_jsx(\"p\",{className:\"api-status checking\",children:\"\\u68C0\\u67E5API\\u8FDE\\u63A5\\u4E2D...\"}),apiStatus.error&&/*#__PURE__*/_jsx(\"p\",{className:\"api-status error\",children:\"\\u65E0\\u6CD5\\u8FDE\\u63A5\\u5230API\\u670D\\u52A1\\uFF0C\\u8BF7\\u786E\\u4FDD\\u540E\\u7AEF\\u670D\\u52A1\\u5DF2\\u542F\\u52A8\"}),apiStatus.data&&/*#__PURE__*/_jsxs(\"p\",{className:\"api-status connected\",children:[\"API\\u670D\\u52A1\\u5DF2\\u8FDE\\u63A5 (\\u5DF2\\u52A0\\u8F7D \",apiStatus.data.loaded_episodes,\" \\u96C6, \",apiStatus.data.total_subtitles,\" \\u6761\\u5B57\\u5E55)\"]}),/*#__PURE__*/_jsx(\"nav\",{className:\"main-nav\",children:/*#__PURE__*/_jsxs(\"ul\",{children:[/*#__PURE__*/_jsx(\"li\",{className:activePage==='search'?'active':'',children:/*#__PURE__*/_jsx(\"button\",{onClick:()=>switchPage('search'),children:\"\\u5B57\\u5E55\\u641C\\u7D22\"})}),/*#__PURE__*/_jsx(\"li\",{className:activePage==='chain-game'?'active':'',children:/*#__PURE__*/_jsx(\"button\",{onClick:()=>switchPage('chain-game'),children:\"\\u6210\\u8BED\\u63A5\\u9F99\"})})]})})]}),/*#__PURE__*/_jsx(\"main\",{className:\"App-main\",children:activePage==='search'?/*#__PURE__*/_jsx(SearchPage,{API_BASE_URL:API_BASE_URL,query:query,setQuery:setQuery,searchResults:results,setSearchResults:setResults,loading:loading,setLoading:setLoading,apiStatus:apiStatus.data?'connected':'error',error:error,setError:setError,selectedResult:selectedResult,setSelectedResult:setSelectedResult,videoUrl:videoUrl,setVideoUrl:setVideoUrl,isVideoLoading:loading,setIsVideoLoading:setLoading,handleSearch:handleSearch,handleGenerateClip:handleGenerateClip,formatTime:formatTime,formatEpisode:formatEpisode,highlightText:highlightText}):/*#__PURE__*/_jsx(ChainGamePage,{API_BASE_URL:API_BASE_URL,apiStatus:apiStatus.data?'connected':'error',formatTime:formatTime,formatEpisode:formatEpisode})}),/*#__PURE__*/_jsx(\"footer\",{className:\"App-footer\",children:/*#__PURE__*/_jsx(\"p\",{children:\"\\u300A\\u540E\\u5BAB\\xB7\\u7504\\u5B1B\\u4F20\\u300B\\u5B57\\u5E55\\u641C\\u7D22\\u7CFB\\u7EDF \\xA92024\"})})]});}export default App;","map":{"version":3,"names":["React","useState","useEffect","axios","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","SearchPage","_ref","API_BASE_URL","query","setQuery","searchResults","setSearchResults","loading","setLoading","apiStatus","error","setError","selectedResult","setSelectedResult","videoUrl","setVideoUrl","isVideoLoading","setIsVideoLoading","handleSearch","handleGenerateClip","formatTime","formatEpisode","highlightText","children","className","onSubmit","type","value","onChange","e","target","placeholder","disabled","length","map","result","index","onClick","episode","start_seconds","end_seconds","dangerouslySetInnerHTML","__html","text","controls","autoPlay","src","ChainGamePage","_ref2","gameStarted","setGameStarted","currentPrompts","setCurrentPrompts","loadingPrompts","setLoadingPrompts","gameLog","setGameLog","currentSentence","setCurrentSentence","nextOptions","setNextOptions","loadingNextOptions","setLoadingNextOptions","gameError","setGameError","selectedOption","setSelectedOption","isExportingVideo","setIsExportingVideo","clipUrls","setClipUrls","isConfirmMode","setIsConfirmMode","fetchRandomPrompts","response","get","params","count","data","sentences","console","refreshRandomPrompts","startNewGame","generateVideoClip","subtitle","post","start_time","end_time","context_seconds","success","video_url","selectStartSentence","sentence","clipUrl","confirmStartSentence","step","fetchNextOptions","cancelSelection","lastChar","getLastValidChar","use_regex","results","filteredResults","filter","item","cleanText","replace","shuffled","sort","Math","random","slice","refreshNextOptions","selectNextSentence","confirmNextSentence","goBackOneStep","newLog","newClipUrls","exportMergedVideo","selectedClipUrls","entry","url","clip_urls","a","document","createElement","href","merged_video_url","download","body","appendChild","click","removeChild","prompt","option","log","App","setResults","setApiStatus","activePage","setActivePage","checkApiStatus","fetch","ok","json","preventDefault","trim","queryParams","URLSearchParams","toString","errorData","method","headers","JSON","stringify","fullVideoUrl","startsWith","seconds","undefined","hours","floor","mins","secs","padStart","regex","RegExp","match","switchPage","page","loaded_episodes","total_subtitles"],"sources":["/Users/h0270/Documents/code/ai-vedio/create_video/subtitle-search-app/src/App.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport './App.css';\nimport axios from 'axios';\n\n// 子页面组件\nconst SearchPage = ({ \n  API_BASE_URL, \n  query, \n  setQuery, \n  searchResults,\n  setSearchResults,\n  loading,\n  setLoading,\n  apiStatus,\n  error,\n  setError,\n  selectedResult,\n  setSelectedResult,\n  videoUrl,\n  setVideoUrl,\n  isVideoLoading,\n  setIsVideoLoading,\n  handleSearch,\n  handleGenerateClip,\n  formatTime,\n  formatEpisode,\n  highlightText\n}) => {\n  return (\n    <>\n      <section className=\"search-area\">\n        <form onSubmit={handleSearch}>\n          <div className=\"search-box\">\n            <input\n              type=\"text\"\n              value={query}\n              onChange={(e) => setQuery(e.target.value)}\n              placeholder=\"输入要搜索的字幕内容...\"\n              disabled={apiStatus !== 'connected'}\n            />\n            <button \n              type=\"submit\" \n              disabled={loading || apiStatus !== 'connected'}\n            >\n              {loading ? '搜索中...' : '搜索'}\n            </button>\n          </div>\n        </form>\n\n        {error && <div className=\"error-message\">{error}</div>}\n      </section>\n\n      <div className=\"content-area\">\n        <section className=\"results-area\">\n          <h2>搜索结果 {searchResults.length > 0 && `(${searchResults.length})`}</h2>\n          \n          {loading ? (\n            <div className=\"loading\">搜索中，请稍候...</div>\n          ) : (\n            <ul className=\"results-list\">\n              {searchResults.map((result, index) => (\n                <li \n                  key={index} \n                  className={selectedResult === result ? 'selected' : ''}\n                  onClick={() => handleGenerateClip(result)}\n                >\n                  <div className=\"result-header\">\n                    <span className=\"episode\">{formatEpisode(result.episode)}</span>\n                    <span className=\"time\">{formatTime(result.start_seconds)} - {formatTime(result.end_seconds)}</span>\n                  </div>\n                  <div \n                    className=\"subtitle-text\"\n                    dangerouslySetInnerHTML={{__html: highlightText(result.text, query)}}\n                  />\n                </li>\n              ))}\n            </ul>\n          )}\n        </section>\n\n        <section className=\"video-area\">\n          <h2>视频播放</h2>\n          {selectedResult ? (\n            <div className=\"video-player\">\n              <div className=\"video-info\">\n                <p><strong>集数:</strong> {formatEpisode(selectedResult.episode)}</p>\n                <p><strong>时间段:</strong> {formatTime(selectedResult.start_seconds)} - {formatTime(selectedResult.end_seconds)}</p>\n                <p><strong>字幕内容:</strong> {selectedResult.text}</p>\n              </div>\n              \n              {isVideoLoading ? (\n                <div className=\"loading-video\">生成视频片段中，请稍候...</div>\n              ) : videoUrl ? (\n                <video \n                  controls \n                  autoPlay \n                  className=\"video-element\"\n                  src={videoUrl}\n                />\n              ) : (\n                <div className=\"video-placeholder\">\n                  {selectedResult ? '准备生成视频片段...' : '请从左侧选择一个搜索结果'}\n                </div>\n              )}\n            </div>\n          ) : (\n            <div className=\"video-placeholder\">\n              请从左侧选择一个搜索结果\n            </div>\n          )}\n        </section>\n      </div>\n    </>\n  );\n};\n\n// 成语接龙游戏组件\nconst ChainGamePage = ({ \n  API_BASE_URL, \n  apiStatus,\n  formatTime,\n  formatEpisode\n}) => {\n  const [gameStarted, setGameStarted] = useState(false);\n  const [currentPrompts, setCurrentPrompts] = useState([]);\n  const [loadingPrompts, setLoadingPrompts] = useState(false);\n  const [gameLog, setGameLog] = useState([]);\n  const [currentSentence, setCurrentSentence] = useState(null);\n  const [nextOptions, setNextOptions] = useState([]);\n  const [loadingNextOptions, setLoadingNextOptions] = useState(false);\n  const [gameError, setGameError] = useState(null);\n  const [videoUrl, setVideoUrl] = useState('');\n  const [isVideoLoading, setIsVideoLoading] = useState(false);\n  const [selectedOption, setSelectedOption] = useState(null);\n  const [isExportingVideo, setIsExportingVideo] = useState(false);\n  const [clipUrls, setClipUrls] = useState([]);\n  const [isConfirmMode, setIsConfirmMode] = useState(false);\n\n  // 获取随机提示句子\n  const fetchRandomPrompts = async () => {\n    setLoadingPrompts(true);\n    setGameError(null);\n    \n    try {\n      const response = await axios.get(`${API_BASE_URL}/api/random_sentences`, {\n        params: { count: 8 }\n      });\n      \n      if (response.data && response.data.sentences) {\n        setCurrentPrompts(response.data.sentences);\n      } else {\n        setGameError('获取提示句子失败');\n      }\n    } catch (error) {\n      console.error('获取提示句子错误:', error);\n      setGameError('无法获取提示句子，请确保API服务正常运行');\n    } finally {\n      setLoadingPrompts(false);\n    }\n  };\n\n  // 刷新随机提示\n  const refreshRandomPrompts = () => {\n    if (apiStatus === 'connected' && !loadingPrompts) {\n      fetchRandomPrompts();\n    }\n  };\n\n  // 开始新游戏\n  const startNewGame = () => {\n    setGameLog([]);\n    fetchRandomPrompts();\n    setGameStarted(false);\n    setCurrentSentence(null);\n    setNextOptions([]);\n    setClipUrls([]);\n    setVideoUrl('');\n    setSelectedOption(null);\n    setIsConfirmMode(false);\n  };\n\n  // 生成视频片段\n  const generateVideoClip = async (subtitle) => {\n    setIsVideoLoading(true);\n    setVideoUrl('');\n    setGameError(null);\n    \n    try {\n      const response = await axios.post(`${API_BASE_URL}/api/generate_clip`, {\n        episode: subtitle.episode,\n        start_time: subtitle.start_seconds,\n        end_time: subtitle.end_seconds,\n        context_seconds: 2\n      });\n\n      if (response.data.success) {\n        setVideoUrl(`${API_BASE_URL}${response.data.video_url}`);\n        return `${API_BASE_URL}${response.data.video_url}`;\n      } else {\n        setGameError('生成视频片段失败');\n        return null;\n      }\n    } catch (error) {\n      console.error('生成视频片段出错:', error);\n      setGameError('视频服务出现错误，请确保视频文件存在且可访问');\n      return null;\n    } finally {\n      setIsVideoLoading(false);\n    }\n  };\n\n  // 选择开始句子\n  const selectStartSentence = async (sentence) => {\n    setSelectedOption(sentence);\n    setIsConfirmMode(true);\n    \n    const clipUrl = await generateVideoClip(sentence);\n    if (!clipUrl) return;\n  };\n\n  // 确认选择开始句子\n  const confirmStartSentence = () => {\n    const sentence = selectedOption;\n    if (!sentence) return;\n    \n    setCurrentSentence(sentence);\n    setGameLog([{...sentence, step: 1, clipUrl: videoUrl}]);\n    setClipUrls([...clipUrls, videoUrl]);\n    setGameStarted(true);\n    fetchNextOptions(sentence.text);\n    setIsConfirmMode(false);\n    setSelectedOption(null);\n  };\n\n  // 取消选择\n  const cancelSelection = () => {\n    setIsConfirmMode(false);\n    setSelectedOption(null);\n    setVideoUrl('');\n  };\n\n  // 获取下一步选项\n  const fetchNextOptions = async (text) => {\n    if (!text) return;\n    \n    setLoadingNextOptions(true);\n    setGameError(null);\n    \n    try {\n      // 获取最后一个字，排除语气词\n      let lastChar = getLastValidChar(text);\n      \n      if (!lastChar) {\n        setGameError('无法识别有效的结尾字符');\n        setLoadingNextOptions(false);\n        return;\n      }\n      \n      const response = await axios.get(`${API_BASE_URL}/api/search`, {\n        params: {\n          query: `^${lastChar}`,\n          use_regex: true\n        }\n      });\n      \n      if (response.data && response.data.results) {\n        // 过滤结果，保留3-8个字的句子\n        const filteredResults = response.data.results.filter(item => {\n          const cleanText = item.text.replace(/[啊呢吗吧呀嘛哦哎嗯呐呵呦诶哈哟]$/, '');\n          return cleanText.length >= 3 && cleanText.length <= 8;\n        });\n        \n        // 随机选择最多8个结果\n        const shuffled = [...filteredResults].sort(() => 0.5 - Math.random());\n        setNextOptions(shuffled.slice(0, 8));\n        \n        if (shuffled.length === 0) {\n          setGameError('没有找到符合条件的接续句子');\n        }\n      } else {\n        setGameError('获取接续句子失败');\n      }\n    } catch (error) {\n      console.error('获取接续句子错误:', error);\n      setGameError('无法获取接续句子，请确保API服务正常运行');\n    } finally {\n      setLoadingNextOptions(false);\n    }\n  };\n\n  // 获取最后一个有效字符（排除语气词）\n  const getLastValidChar = (text) => {\n    if (!text || text.length === 0) return null;\n    \n    // 排除常见语气词\n    const cleanText = text.replace(/[啊呢吗吧呀嘛哦哎嗯呐呵呦诶哈哟]$/, '');\n    return cleanText.length > 0 ? cleanText[cleanText.length - 1] : null;\n  };\n\n  // 刷新下一步选项\n  const refreshNextOptions = () => {\n    if (currentSentence && !loadingNextOptions) {\n      fetchNextOptions(currentSentence.text);\n    }\n  };\n\n  // 选择下一个句子\n  const selectNextSentence = async (sentence) => {\n    setSelectedOption(sentence);\n    setIsConfirmMode(true);\n    \n    const clipUrl = await generateVideoClip(sentence);\n    if (!clipUrl) return;\n  };\n\n  // 确认选择下一个句子\n  const confirmNextSentence = () => {\n    const sentence = selectedOption;\n    if (!sentence) return;\n    \n    setCurrentSentence(sentence);\n    setGameLog([...gameLog, {...sentence, step: gameLog.length + 1, clipUrl: videoUrl}]);\n    setClipUrls([...clipUrls, videoUrl]);\n    fetchNextOptions(sentence.text);\n    setIsConfirmMode(false);\n    setSelectedOption(null);\n  };\n\n  // 回到上一步\n  const goBackOneStep = () => {\n    if (gameLog.length <= 1) {\n      // 只有一步，回到选择开始句子\n      setGameStarted(false);\n      setGameLog([]);\n      setCurrentSentence(null);\n      setNextOptions([]);\n      setClipUrls([]);\n      return;\n    }\n    \n    // 删除最后一步\n    const newLog = gameLog.slice(0, -1);\n    const newClipUrls = clipUrls.slice(0, -1);\n    setGameLog(newLog);\n    setClipUrls(newClipUrls);\n    setCurrentSentence(newLog[newLog.length - 1]);\n    fetchNextOptions(newLog[newLog.length - 1].text);\n  };\n\n  // 导出合并视频\n  const exportMergedVideo = async () => {\n    // 只从gameLog中获取选中的视频URL，而不是使用clipUrls\n    const selectedClipUrls = gameLog.map(entry => entry.clipUrl).filter(url => url);\n    \n    if (selectedClipUrls.length === 0) {\n      setGameError('没有可导出的视频');\n      return;\n    }\n    \n    setIsExportingVideo(true);\n    setGameError(null);\n    \n    try {\n      const response = await axios.post(`${API_BASE_URL}/api/merge_clips`, {\n        clip_urls: selectedClipUrls\n      });\n      \n      if (response.data.success) {\n        // 触发下载\n        const a = document.createElement('a');\n        a.href = `${API_BASE_URL}${response.data.merged_video_url}`;\n        a.download = '甄嬛传接龙.mp4';\n        document.body.appendChild(a);\n        a.click();\n        document.body.removeChild(a);\n      } else {\n        setGameError('导出视频失败');\n      }\n    } catch (error) {\n      console.error('导出视频错误:', error);\n      setGameError('导出视频失败，请确保服务器正常运行');\n    } finally {\n      setIsExportingVideo(false);\n    }\n  };\n\n  // 初始加载时获取随机提示\n  useEffect(() => {\n    if (apiStatus === 'connected') {\n      fetchRandomPrompts();\n    }\n  }, [apiStatus]);\n\n  return (\n    <div className=\"chain-game-container\">\n      <div className=\"game-controls\">\n        <button \n          onClick={startNewGame}\n          className=\"new-game-btn\"\n          disabled={apiStatus !== 'connected'}\n        >\n          新游戏\n        </button>\n        {gameStarted && (\n          <button \n            onClick={goBackOneStep}\n            className=\"back-btn\"\n            disabled={gameLog.length === 0}\n          >\n            上一步\n          </button>\n        )}\n        {clipUrls.length > 1 && (\n          <button\n            onClick={exportMergedVideo}\n            className=\"export-btn\"\n            disabled={isExportingVideo}\n          >\n            {isExportingVideo ? '导出中...' : '导出接龙视频'}\n          </button>\n        )}\n      </div>\n      \n      {gameError && <div className=\"error-message\">{gameError}</div>}\n      \n      <div className=\"game-content\">\n        {/* 左侧：候选词区域 */}\n        <div className=\"game-candidates\">\n          {!gameStarted ? (\n            <div className=\"start-game-section\">\n              <div className=\"section-header\">\n                <h2>选择开始句子</h2>\n                <button \n                  onClick={refreshRandomPrompts}\n                  className=\"refresh-btn\"\n                  disabled={loadingPrompts || apiStatus !== 'connected'}\n                >\n                  换一批\n                </button>\n              </div>\n              \n              {loadingPrompts ? (\n                <div className=\"loading\">加载提示句子中...</div>\n              ) : (\n                <ul className=\"prompts-list\">\n                  {currentPrompts.map((prompt, index) => (\n                    <li \n                      key={index} \n                      onClick={() => selectStartSentence(prompt)}\n                      className={selectedOption === prompt ? 'prompt-item selected' : 'prompt-item'}\n                    >\n                      <div className=\"prompt-text\">{prompt.text}</div>\n                      <div className=\"prompt-info\">\n                        <span className=\"episode\">{formatEpisode(prompt.episode)}</span>\n                        <span className=\"time\">{formatTime(prompt.start_seconds)}</span>\n                      </div>\n                    </li>\n                  ))}\n                </ul>\n              )}\n              {currentPrompts.length === 0 && !loadingPrompts && (\n                <div className=\"no-prompts\">\n                  <p>没有可用的提示句子</p>\n                  <button \n                    onClick={fetchRandomPrompts}\n                    disabled={apiStatus !== 'connected'}\n                  >\n                    重新获取\n                  </button>\n                </div>\n              )}\n            </div>\n          ) : (\n            <>\n              <div className=\"current-section\">\n                <h2>当前句子</h2>\n                <div className=\"current-sentence\">\n                  <div className=\"current-text\">{currentSentence?.text}</div>\n                  <div className=\"current-info\">\n                    <span className=\"episode\">{formatEpisode(currentSentence?.episode)}</span>\n                    <span className=\"time\">{formatTime(currentSentence?.start_seconds)}</span>\n                  </div>\n                  <div className=\"next-hint\">\n                    下一句需以「{getLastValidChar(currentSentence?.text)}」字开头\n                  </div>\n                </div>\n              </div>\n                \n              <div className=\"next-options-section\">\n                <div className=\"section-header\">\n                  <h2>可选接续</h2>\n                  <button \n                    onClick={refreshNextOptions}\n                    className=\"refresh-btn\"\n                    disabled={loadingNextOptions}\n                  >\n                    换一批\n                  </button>\n                </div>\n                \n                {loadingNextOptions ? (\n                  <div className=\"loading\">加载接续句子中...</div>\n                ) : (\n                  <ul className=\"options-list\">\n                    {nextOptions.map((option, index) => (\n                      <li \n                        key={index}\n                        onClick={() => selectNextSentence(option)}\n                        className={selectedOption === option ? 'option-item selected' : 'option-item'}\n                      >\n                        <div className=\"option-text\">{option.text}</div>\n                        <div className=\"option-info\">\n                          <span className=\"episode\">{formatEpisode(option.episode)}</span>\n                          <span className=\"time\">{formatTime(option.start_seconds)}</span>\n                        </div>\n                      </li>\n                    ))}\n                  </ul>\n                )}\n                {nextOptions.length === 0 && !loadingNextOptions && (\n                  <div className=\"no-options\">\n                    <p>没有找到合适的接续句子</p>\n                    <button onClick={startNewGame}>重新开始</button>\n                  </div>\n                )}\n              </div>\n            </>\n          )}\n\n          {/* 接龙记录 */}\n          <div className=\"game-log-section\">\n            <h2>接龙记录</h2>\n            {gameLog.length > 0 ? (\n              <ol className=\"game-log-list\">\n                {gameLog.map((log, index) => (\n                  <li key={index} className=\"log-item\">\n                    <div className=\"log-text\">{log.text}</div>\n                    <div className=\"log-info\">\n                      <span className=\"episode\">{formatEpisode(log.episode)}</span>\n                      <span className=\"time\">{formatTime(log.start_seconds)}</span>\n                      {log.clipUrl && (\n                        <span className=\"clip-info\">\n                          <i className=\"video-icon\">🎬</i>\n                        </span>\n                      )}\n                    </div>\n                  </li>\n                ))}\n              </ol>\n            ) : (\n              <div className=\"empty-log\">尚未开始游戏</div>\n            )}\n          </div>\n        </div>\n\n        {/* 右侧：视频预览区域 */}\n        <div className=\"game-video-preview\">\n          {isConfirmMode && (\n            <div className=\"confirm-section\">\n              <div className=\"selected-sentence\">\n                <div className=\"selected-text\">{selectedOption?.text}</div>\n                <div className=\"selected-info\">\n                  <span className=\"episode\">{formatEpisode(selectedOption?.episode)}</span>\n                  <span className=\"time\">{formatTime(selectedOption?.start_seconds)}</span>\n                </div>\n              </div>\n              \n              <div className=\"video-preview\">\n                {isVideoLoading ? (\n                  <div className=\"loading-video\">生成视频片段中，请稍候...</div>\n                ) : videoUrl ? (\n                  <video \n                    controls \n                    autoPlay \n                    className=\"video-element\"\n                    src={videoUrl}\n                  />\n                ) : (\n                  <div className=\"video-placeholder\">准备生成视频片段...</div>\n                )}\n              </div>\n              \n              <div className=\"confirm-actions\">\n                <button \n                  onClick={gameStarted ? confirmNextSentence : confirmStartSentence}\n                  className=\"confirm-btn\"\n                  disabled={!videoUrl || isVideoLoading}\n                >\n                  确认选择\n                </button>\n                <button \n                  onClick={cancelSelection}\n                  className=\"cancel-btn\"\n                >\n                  取消选择\n                </button>\n              </div>\n            </div>\n          )}\n          {!isConfirmMode && (\n            <div className=\"video-placeholder large\">\n              <div className=\"placeholder-text\">\n                <p>请从左侧选择一个句子</p>\n                <p>选择后将在此处预览视频</p>\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nfunction App() {\n  const [query, setQuery] = useState('');\n  const [results, setResults] = useState([]);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState('');\n  const [selectedResult, setSelectedResult] = useState(null);\n  const [videoUrl, setVideoUrl] = useState('');\n  const [apiStatus, setApiStatus] = useState({loading: true, error: null, data: null});\n  const [activePage, setActivePage] = useState('search'); // 'search' 或 'chain-game'\n  \n  // API 相关配置\n  const API_BASE_URL = 'http://localhost:8089';\n  \n  // 检查API状态\n  useEffect(() => {\n    const checkApiStatus = async () => {\n      try {\n        const response = await fetch(`${API_BASE_URL}/api/status`);\n        \n        if (response.ok) {\n          const data = await response.json();\n          setApiStatus({loading: false, error: null, data});\n          console.log(\"API状态:\", data);\n        } else {\n          setApiStatus({loading: false, error: '无法连接到API服务', data: null});\n        }\n      } catch (error) {\n        console.error(\"API连接错误:\", error);\n        setApiStatus({loading: false, error: '无法连接到API服务', data: null});\n      }\n    };\n    \n    checkApiStatus();\n  }, []);\n  \n  const handleSearch = async (e) => {\n    e.preventDefault();\n    if (!query.trim()) {\n      setError('请输入搜索内容');\n      return;\n    }\n    \n    setLoading(true);\n    setError('');\n    setResults([]);\n    setSelectedResult(null);\n    setVideoUrl('');\n    \n    try {\n      // 构建查询URL\n      const queryParams = new URLSearchParams({\n        query: query.trim()\n      }).toString();\n      \n      const response = await fetch(`${API_BASE_URL}/api/search?${queryParams}`);\n      \n      if (response.ok) {\n        const data = await response.json();\n        setResults(data.results || []);\n        if (data.results && data.results.length === 0) {\n          setError('没有找到匹配的结果');\n        }\n      } else {\n        const errorData = await response.json();\n        setError(errorData.error || '搜索失败');\n      }\n    } catch (error) {\n      console.error('搜索失败:', error);\n      setError('搜索请求失败，请检查网络连接');\n    } finally {\n      setLoading(false);\n    }\n  };\n  \n  const handleGenerateClip = async (result) => {\n    if (!result) return;\n    \n    setSelectedResult(result);\n    setLoading(true);\n    setError('');\n    setVideoUrl('');\n    \n    try {\n      const response = await fetch(`${API_BASE_URL}/api/generate_clip`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          episode: result.episode,\n          start_time: result.start_seconds,\n          end_time: result.end_seconds,\n          context_seconds: 3 // 上下文秒数\n        })\n      });\n      \n      if (response.ok) {\n        const data = await response.json();\n        if (data.success) {\n          // 确保视频URL包含完整的基础URL\n          const fullVideoUrl = data.video_url.startsWith('http') \n            ? data.video_url \n            : `${API_BASE_URL}${data.video_url}`;\n          setVideoUrl(fullVideoUrl);\n        } else {\n          setError(data.error || '视频片段生成失败');\n        }\n      } else {\n        const errorData = await response.json();\n        setError(errorData.error || '请求失败');\n      }\n    } catch (error) {\n      console.error('生成视频片段失败:', error);\n      setError('请求失败，请检查网络连接');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // 格式化时间显示\n  const formatTime = (seconds) => {\n    if (seconds === undefined || seconds === null) return '00:00:00';\n    const hours = Math.floor(seconds / 3600);\n    const mins = Math.floor((seconds % 3600) / 60);\n    const secs = Math.floor(seconds % 60);\n    return `${hours.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\n  };\n\n  // 格式化集数显示\n  const formatEpisode = (episode) => {\n    if (!episode) return '';\n    return episode.replace('后宫·甄嬛传', '第') + '集';\n  };\n\n  // 高亮显示匹配文本\n  const highlightText = (text, query) => {\n    if (!query || !text) return text;\n    \n    try {\n      const regex = new RegExp(query, 'gi');\n      return text.replace(regex, match => `<mark>${match}</mark>`);\n    } catch (e) {\n      return text;\n    }\n  };\n\n  // 切换页面\n  const switchPage = (page) => {\n    setActivePage(page);\n  };\n\n  return (\n    <div className=\"App\">\n      <header className=\"App-header\">\n        <h1>《后宫·甄嬛传》字幕搜索系统</h1>\n        {apiStatus.loading && <p className=\"api-status checking\">检查API连接中...</p>}\n        {apiStatus.error && <p className=\"api-status error\">无法连接到API服务，请确保后端服务已启动</p>}\n        {apiStatus.data && <p className=\"api-status connected\">API服务已连接 (已加载 {apiStatus.data.loaded_episodes} 集, {apiStatus.data.total_subtitles} 条字幕)</p>}\n        \n        <nav className=\"main-nav\">\n          <ul>\n            <li className={activePage === 'search' ? 'active' : ''}>\n              <button onClick={() => switchPage('search')}>字幕搜索</button>\n            </li>\n            <li className={activePage === 'chain-game' ? 'active' : ''}>\n              <button onClick={() => switchPage('chain-game')}>成语接龙</button>\n            </li>\n          </ul>\n        </nav>\n      </header>\n\n      <main className=\"App-main\">\n        {activePage === 'search' ? (\n          <SearchPage\n            API_BASE_URL={API_BASE_URL}\n            query={query}\n            setQuery={setQuery}\n            searchResults={results}\n            setSearchResults={setResults}\n            loading={loading}\n            setLoading={setLoading}\n            apiStatus={apiStatus.data ? 'connected' : 'error'}\n            error={error}\n            setError={setError}\n            selectedResult={selectedResult}\n            setSelectedResult={setSelectedResult}\n            videoUrl={videoUrl}\n            setVideoUrl={setVideoUrl}\n            isVideoLoading={loading}\n            setIsVideoLoading={setLoading}\n            handleSearch={handleSearch}\n            handleGenerateClip={handleGenerateClip}\n            formatTime={formatTime}\n            formatEpisode={formatEpisode}\n            highlightText={highlightText}\n          />\n        ) : (\n          <ChainGamePage\n            API_BASE_URL={API_BASE_URL}\n            apiStatus={apiStatus.data ? 'connected' : 'error'}\n            formatTime={formatTime}\n            formatEpisode={formatEpisode}\n          />\n        )}\n      </main>\n\n      <footer className=\"App-footer\">\n        <p>《后宫·甄嬛传》字幕搜索系统 ©2024</p>\n      </footer>\n    </div>\n  );\n}\n\nexport default App; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}