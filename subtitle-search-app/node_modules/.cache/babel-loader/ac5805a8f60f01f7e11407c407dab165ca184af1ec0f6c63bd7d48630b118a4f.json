{"ast":null,"code":"import React,{useState,useEffect}from'react';import'./App.css';import axios from'axios';// 子页面组件\nimport{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const SearchPage=_ref=>{let{API_BASE_URL,query,setQuery,searchResults,setSearchResults,loading,setLoading,apiStatus,error,setError,selectedResult,setSelectedResult,videoUrl,setVideoUrl,isVideoLoading,setIsVideoLoading,handleSearch,handleGenerateClip,formatTime,formatEpisode,highlightText}=_ref;return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"section\",{className:\"search-area\",children:[/*#__PURE__*/_jsx(\"form\",{onSubmit:handleSearch,children:/*#__PURE__*/_jsxs(\"div\",{className:\"search-box\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:query,onChange:e=>setQuery(e.target.value),placeholder:\"\\u8F93\\u5165\\u8981\\u641C\\u7D22\\u7684\\u5B57\\u5E55\\u5185\\u5BB9...\",disabled:apiStatus!=='connected'}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:loading||apiStatus!=='connected',children:loading?'搜索中...':'搜索'})]})}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"error-message\",children:error})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"content-area\",children:[/*#__PURE__*/_jsxs(\"section\",{className:\"results-area\",children:[/*#__PURE__*/_jsxs(\"h2\",{children:[\"\\u641C\\u7D22\\u7ED3\\u679C \",searchResults.length>0&&`(${searchResults.length})`]}),loading?/*#__PURE__*/_jsx(\"div\",{className:\"loading\",children:\"\\u641C\\u7D22\\u4E2D\\uFF0C\\u8BF7\\u7A0D\\u5019...\"}):/*#__PURE__*/_jsx(\"ul\",{className:\"results-list\",children:searchResults.map((result,index)=>/*#__PURE__*/_jsxs(\"li\",{className:selectedResult===result?'selected':'',onClick:()=>handleGenerateClip(result),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"result-header\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"episode\",children:formatEpisode(result.episode)}),/*#__PURE__*/_jsxs(\"span\",{className:\"time\",children:[formatTime(result.start_seconds),\" - \",formatTime(result.end_seconds)]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"subtitle-text\",dangerouslySetInnerHTML:{__html:highlightText(result.text,query)}})]},index))})]}),/*#__PURE__*/_jsxs(\"section\",{className:\"video-area\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\u89C6\\u9891\\u64AD\\u653E\"}),selectedResult?/*#__PURE__*/_jsxs(\"div\",{className:\"video-player\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"video-info\",children:[/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\u96C6\\u6570:\"}),\" \",formatEpisode(selectedResult.episode)]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\u65F6\\u95F4\\u6BB5:\"}),\" \",formatTime(selectedResult.start_seconds),\" - \",formatTime(selectedResult.end_seconds)]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\u5B57\\u5E55\\u5185\\u5BB9:\"}),\" \",selectedResult.text]})]}),isVideoLoading?/*#__PURE__*/_jsx(\"div\",{className:\"loading-video\",children:\"\\u751F\\u6210\\u89C6\\u9891\\u7247\\u6BB5\\u4E2D\\uFF0C\\u8BF7\\u7A0D\\u5019...\"}):videoUrl?/*#__PURE__*/_jsx(\"video\",{controls:true,autoPlay:true,className:\"video-element\",src:videoUrl}):/*#__PURE__*/_jsx(\"div\",{className:\"video-placeholder\",children:selectedResult?'准备生成视频片段...':'请从左侧选择一个搜索结果'})]}):/*#__PURE__*/_jsx(\"div\",{className:\"video-placeholder\",children:\"\\u8BF7\\u4ECE\\u5DE6\\u4FA7\\u9009\\u62E9\\u4E00\\u4E2A\\u641C\\u7D22\\u7ED3\\u679C\"})]})]})]});};// 成语接龙游戏组件\nconst ChainGamePage=_ref2=>{let{API_BASE_URL,apiStatus,formatTime,formatEpisode}=_ref2;const[gameStarted,setGameStarted]=useState(false);const[currentPrompts,setCurrentPrompts]=useState([]);const[loadingPrompts,setLoadingPrompts]=useState(false);const[gameLog,setGameLog]=useState([]);const[currentSentence,setCurrentSentence]=useState(null);const[nextOptions,setNextOptions]=useState([]);const[loadingNextOptions,setLoadingNextOptions]=useState(false);const[gameError,setGameError]=useState(null);const[videoUrl,setVideoUrl]=useState('');const[isVideoLoading,setIsVideoLoading]=useState(false);const[selectedOption,setSelectedOption]=useState(null);const[isExportingVideo,setIsExportingVideo]=useState(false);const[clipUrls,setClipUrls]=useState([]);const[isConfirmMode,setIsConfirmMode]=useState(false);// 获取随机提示句子\nconst fetchRandomPrompts=async()=>{setLoadingPrompts(true);setGameError(null);try{const response=await axios.get(`${API_BASE_URL}/api/random_sentences`,{params:{count:8}});if(response.data&&response.data.sentences){setCurrentPrompts(response.data.sentences);}else{setGameError('获取提示句子失败');}}catch(error){console.error('获取提示句子错误:',error);setGameError('无法获取提示句子，请确保API服务正常运行');}finally{setLoadingPrompts(false);}};// 刷新随机提示\nconst refreshRandomPrompts=()=>{if(apiStatus==='connected'&&!loadingPrompts){fetchRandomPrompts();}};// 生成视频片段\nconst generateVideoClip=async subtitle=>{setIsVideoLoading(true);setVideoUrl('');setGameError(null);try{const response=await axios.post(`${API_BASE_URL}/api/generate_clip`,{episode:subtitle.episode,start_time:subtitle.start_seconds,end_time:subtitle.end_seconds,context_seconds:2});if(response.data.success){const clipUrl=`${API_BASE_URL}${response.data.video_url}`;setVideoUrl(clipUrl);return clipUrl;}else{setGameError('生成视频片段失败');return null;}}catch(error){console.error('生成视频片段出错:',error);setGameError('视频服务出现错误，请确保视频文件存在且可访问');return null;}finally{setIsVideoLoading(false);}};// 选择开始句子\nconst selectStartSentence=prompt=>{setSelectedOption(prompt);setIsConfirmMode(true);generateVideoClip(prompt);};// 确认选择开始句子\nconst confirmStartSentence=()=>{const sentence=selectedOption;if(!sentence)return;setCurrentSentence(sentence);setGameLog([{...sentence,step:1,clipUrl:videoUrl}]);setClipUrls([...clipUrls,videoUrl]);setGameStarted(true);fetchNextOptions(sentence.text);setIsConfirmMode(false);setSelectedOption(null);};// 取消选择\nconst cancelSelection=()=>{setIsConfirmMode(false);setSelectedOption(null);setVideoUrl('');};// 选择下一个句子\nconst selectNextSentence=option=>{setSelectedOption(option);setIsConfirmMode(true);generateVideoClip(option);};// 确认选择下一个句子\nconst confirmNextSentence=()=>{const sentence=selectedOption;if(!sentence)return;setCurrentSentence(sentence);setGameLog([...gameLog,{...sentence,step:gameLog.length+1,clipUrl:videoUrl}]);setClipUrls([...clipUrls,videoUrl]);fetchNextOptions(sentence.text);setIsConfirmMode(false);setSelectedOption(null);};// 获取下一步选项\nconst fetchNextOptions=async text=>{if(!text)return;setLoadingNextOptions(true);setGameError(null);try{// 获取最后一个字，排除语气词\nlet lastChar=getLastValidChar(text);if(!lastChar){setGameError('无法识别有效的结尾字符');setLoadingNextOptions(false);return;}console.log(`正在查找以\"${lastChar}\"开头的句子...`);const response=await fetch(`${API_BASE_URL}/api/search?query=${encodeURIComponent(`^${lastChar}`)}&use_regex=true`);if(!response.ok){throw new Error(`API请求失败: ${response.status}`);}const data=await response.json();if(data&&data.results){console.log(`API返回了 ${data.results.length} 条结果`);// 过滤结果，保留3-8个字的句子\nconst filteredResults=data.results.filter(item=>{const cleanText=item.text.replace(/[啊呢吗吧呀嘛哦哎嗯呐呵呦诶哈哟]$/,'');return cleanText.length>=3&&cleanText.length<=8;});console.log(`过滤后还有 ${filteredResults.length} 条结果`);if(filteredResults.length===0){// 如果没有找到结果，尝试不使用正则表达式的精确查询\nconsole.log(`尝试使用精确查询搜索以\"${lastChar}\"开头的句子`);const fallbackResponse=await fetch(`${API_BASE_URL}/api/search?query=${encodeURIComponent(lastChar)}`);const fallbackData=await fallbackResponse.json();if(fallbackData&&fallbackData.results){console.log(`精确查询返回了 ${fallbackData.results.length} 条结果`);// 手动过滤以lastChar开头的结果\nconst manualFilteredResults=fallbackData.results.filter(item=>{return item.text.startsWith(lastChar)&&item.text.length>=3&&item.text.length<=8;});if(manualFilteredResults.length>0){console.log(`手动过滤后找到 ${manualFilteredResults.length} 条结果`);// 随机选择最多8个结果\nconst shuffled=[...manualFilteredResults].sort(()=>0.5-Math.random());setNextOptions(shuffled.slice(0,8));setLoadingNextOptions(false);return;}}setGameError(`没有找到以\"${lastChar}\"开头的句子`);}else{// 随机选择最多8个结果\nconst shuffled=[...filteredResults].sort(()=>0.5-Math.random());setNextOptions(shuffled.slice(0,8));}}else{setGameError('获取接续句子失败');}}catch(error){console.error('获取接续句子错误:',error);setGameError(`查询错误: ${error.message}`);}finally{setLoadingNextOptions(false);}};// 获取最后一个有效字符（排除语气词）\nconst getLastValidChar=text=>{if(!text||text.length===0)return null;// 排除常见语气词\nconst cleanText=text.replace(/[啊呢吗吧呀嘛哦哎嗯呐呵呦诶哈哟]$/,'');return cleanText.length>0?cleanText[cleanText.length-1]:null;};// 刷新下一步选项\nconst refreshNextOptions=()=>{if(currentSentence&&!loadingNextOptions){fetchNextOptions(currentSentence.text);}};// 回到上一步\nconst goBackOneStep=()=>{if(gameLog.length<=1){// 只有一步，回到选择开始句子\nsetGameStarted(false);setGameLog([]);setCurrentSentence(null);setNextOptions([]);setClipUrls([]);return;}// 删除最后一步\nconst newLog=gameLog.slice(0,-1);const newClipUrls=clipUrls.slice(0,-1);setGameLog(newLog);setClipUrls(newClipUrls);setCurrentSentence(newLog[newLog.length-1]);fetchNextOptions(newLog[newLog.length-1].text);};// 导出合并视频\nconst exportMergedVideo=async()=>{// 只从gameLog中获取选中的视频URL，而不是使用clipUrls\nconst selectedClipUrls=gameLog.map(entry=>entry.clipUrl).filter(url=>url);if(selectedClipUrls.length===0){setGameError('没有可导出的视频');return;}setIsExportingVideo(true);setGameError(null);try{const response=await axios.post(`${API_BASE_URL}/api/merge_clips`,{clip_urls:selectedClipUrls});if(response.data.success){// 触发下载\nconst a=document.createElement('a');// 注意这里使用video_url字段\na.href=`${API_BASE_URL}${response.data.video_url||response.data.merged_video_url}`;a.download='甄嬛传接龙.mp4';document.body.appendChild(a);a.click();document.body.removeChild(a);}else{setGameError('导出视频失败');}}catch(error){console.error('导出视频错误:',error);setGameError('导出视频失败，请确保服务器正常运行');}finally{setIsExportingVideo(false);}};// 开始新游戏\nconst startNewGame=()=>{setGameLog([]);fetchRandomPrompts();setGameStarted(false);setCurrentSentence(null);setNextOptions([]);setClipUrls([]);setVideoUrl('');setSelectedOption(null);setIsConfirmMode(false);};// 初始加载时获取随机提示\nuseEffect(()=>{if(apiStatus==='connected'){fetchRandomPrompts();}},[apiStatus]);return/*#__PURE__*/_jsxs(\"div\",{className:\"chain-game-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"game-controls\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:startNewGame,className:\"new-game-btn\",disabled:apiStatus!=='connected',children:\"\\u65B0\\u6E38\\u620F\"}),gameStarted&&/*#__PURE__*/_jsx(\"button\",{onClick:goBackOneStep,className:\"back-btn\",disabled:gameLog.length===0,children:\"\\u4E0A\\u4E00\\u6B65\"}),clipUrls.length>1&&/*#__PURE__*/_jsx(\"button\",{onClick:exportMergedVideo,className:\"export-btn\",disabled:isExportingVideo,children:isExportingVideo?'导出中...':'导出接龙视频'})]}),gameError&&/*#__PURE__*/_jsx(\"div\",{className:\"error-message\",children:gameError}),/*#__PURE__*/_jsxs(\"div\",{className:\"game-content\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"game-candidates\",children:[!gameStarted?/*#__PURE__*/_jsxs(\"div\",{className:\"start-game-section\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"section-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\u9009\\u62E9\\u5F00\\u59CB\\u53E5\\u5B50\"}),/*#__PURE__*/_jsx(\"button\",{onClick:refreshRandomPrompts,className:\"refresh-btn\",disabled:loadingPrompts||apiStatus!=='connected',children:\"\\u6362\\u4E00\\u6279\"})]}),loadingPrompts?/*#__PURE__*/_jsx(\"div\",{className:\"loading\",children:\"\\u52A0\\u8F7D\\u63D0\\u793A\\u53E5\\u5B50\\u4E2D...\"}):/*#__PURE__*/_jsx(\"ul\",{className:\"prompts-list\",children:currentPrompts.map((prompt,index)=>/*#__PURE__*/_jsxs(\"li\",{onClick:()=>selectStartSentence(prompt),className:selectedOption===prompt?'prompt-item selected':'prompt-item',children:[/*#__PURE__*/_jsx(\"div\",{className:\"prompt-text\",children:prompt.text}),/*#__PURE__*/_jsxs(\"div\",{className:\"prompt-info\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"episode\",children:formatEpisode(prompt.episode)}),/*#__PURE__*/_jsx(\"span\",{className:\"time\",children:formatTime(prompt.start_seconds)}),/*#__PURE__*/_jsx(\"span\",{className:`sentence-type ${analyzeSentenceType(prompt.text)}`,children:analyzeSentenceType(prompt.text)})]})]},index))}),currentPrompts.length===0&&!loadingPrompts&&/*#__PURE__*/_jsxs(\"div\",{className:\"no-prompts\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"\\u6CA1\\u6709\\u53EF\\u7528\\u7684\\u63D0\\u793A\\u53E5\\u5B50\"}),/*#__PURE__*/_jsx(\"button\",{onClick:fetchRandomPrompts,disabled:apiStatus!=='connected',children:\"\\u91CD\\u65B0\\u83B7\\u53D6\"})]})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"current-section\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\u5F53\\u524D\\u53E5\\u5B50\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"current-sentence\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"current-text\",children:currentSentence===null||currentSentence===void 0?void 0:currentSentence.text}),/*#__PURE__*/_jsxs(\"div\",{className:\"current-info\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"episode\",children:formatEpisode(currentSentence===null||currentSentence===void 0?void 0:currentSentence.episode)}),/*#__PURE__*/_jsx(\"span\",{className:\"time\",children:formatTime(currentSentence===null||currentSentence===void 0?void 0:currentSentence.start_seconds)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"next-hint\",children:[\"\\u4E0B\\u4E00\\u53E5\\u9700\\u4EE5\\u300C\",getLastValidChar(currentSentence===null||currentSentence===void 0?void 0:currentSentence.text),\"\\u300D\\u5B57\\u5F00\\u5934\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"next-options-section\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"section-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\u53EF\\u9009\\u63A5\\u7EED\"}),/*#__PURE__*/_jsx(\"button\",{onClick:refreshNextOptions,className:\"refresh-btn\",disabled:loadingNextOptions,children:\"\\u6362\\u4E00\\u6279\"})]}),loadingNextOptions?/*#__PURE__*/_jsx(\"div\",{className:\"loading\",children:\"\\u52A0\\u8F7D\\u63A5\\u7EED\\u53E5\\u5B50\\u4E2D...\"}):/*#__PURE__*/_jsx(\"ul\",{className:\"options-list\",children:nextOptions.map((option,index)=>/*#__PURE__*/_jsxs(\"li\",{onClick:()=>selectNextSentence(option),className:selectedOption===option?'option-item selected':'option-item',children:[/*#__PURE__*/_jsx(\"div\",{className:\"option-text\",children:option.text}),/*#__PURE__*/_jsxs(\"div\",{className:\"option-info\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"episode\",children:formatEpisode(option.episode)}),/*#__PURE__*/_jsx(\"span\",{className:\"time\",children:formatTime(option.start_seconds)}),/*#__PURE__*/_jsx(\"span\",{className:`sentence-type ${analyzeSentenceType(option.text)}`,children:analyzeSentenceType(option.text)})]})]},index))}),nextOptions.length===0&&!loadingNextOptions&&/*#__PURE__*/_jsxs(\"div\",{className:\"no-options\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"\\u6CA1\\u6709\\u627E\\u5230\\u5408\\u9002\\u7684\\u63A5\\u7EED\\u53E5\\u5B50\"}),/*#__PURE__*/_jsx(\"button\",{onClick:startNewGame,children:\"\\u91CD\\u65B0\\u5F00\\u59CB\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"game-log-section\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\u63A5\\u9F99\\u8BB0\\u5F55\"}),gameLog.length>0?/*#__PURE__*/_jsx(\"ol\",{className:\"game-log-list\",children:gameLog.map((log,index)=>/*#__PURE__*/_jsxs(\"li\",{className:\"log-item\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"log-text\",children:log.text}),/*#__PURE__*/_jsxs(\"div\",{className:\"log-info\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"episode\",children:formatEpisode(log.episode)}),/*#__PURE__*/_jsx(\"span\",{className:\"time\",children:formatTime(log.start_seconds)}),log.clipUrl&&/*#__PURE__*/_jsx(\"span\",{className:\"clip-info\",children:/*#__PURE__*/_jsx(\"i\",{className:\"video-icon\",children:\"\\uD83C\\uDFAC\"})})]})]},index))}):/*#__PURE__*/_jsx(\"div\",{className:\"empty-log\",children:\"\\u5C1A\\u672A\\u5F00\\u59CB\\u6E38\\u620F\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"game-video-preview\",children:[isConfirmMode&&/*#__PURE__*/_jsxs(\"div\",{className:\"confirm-section\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"selected-sentence\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"selected-text\",children:selectedOption===null||selectedOption===void 0?void 0:selectedOption.text}),/*#__PURE__*/_jsxs(\"div\",{className:\"selected-info\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"episode\",children:formatEpisode(selectedOption===null||selectedOption===void 0?void 0:selectedOption.episode)}),/*#__PURE__*/_jsx(\"span\",{className:\"time\",children:formatTime(selectedOption===null||selectedOption===void 0?void 0:selectedOption.start_seconds)})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"video-preview\",children:isVideoLoading?/*#__PURE__*/_jsx(\"div\",{className:\"loading-video\",children:\"\\u751F\\u6210\\u89C6\\u9891\\u7247\\u6BB5\\u4E2D\\uFF0C\\u8BF7\\u7A0D\\u5019...\"}):videoUrl?/*#__PURE__*/_jsx(\"video\",{controls:true,autoPlay:true,className:\"video-element\",src:videoUrl}):/*#__PURE__*/_jsx(\"div\",{className:\"video-placeholder\",children:\"\\u51C6\\u5907\\u751F\\u6210\\u89C6\\u9891\\u7247\\u6BB5...\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"confirm-buttons\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"confirm-btn\",onClick:gameStarted?confirmNextSentence:confirmStartSentence,disabled:isVideoLoading||!videoUrl,children:\"\\u786E\\u8BA4\\u9009\\u62E9\"}),/*#__PURE__*/_jsx(\"button\",{className:\"cancel-btn\",onClick:cancelSelection,children:\"\\u53D6\\u6D88\\u9009\\u62E9\"})]})]}),!isConfirmMode&&/*#__PURE__*/_jsxs(\"div\",{className:\"video-section\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\u89C6\\u9891\\u9884\\u89C8\"}),isVideoLoading?/*#__PURE__*/_jsx(\"div\",{className:\"loading-video\",children:\"\\u751F\\u6210\\u89C6\\u9891\\u7247\\u6BB5\\u4E2D\\uFF0C\\u8BF7\\u7A0D\\u5019...\"}):videoUrl?/*#__PURE__*/_jsx(\"video\",{controls:true,autoPlay:true,className:\"video-element\",src:videoUrl}):/*#__PURE__*/_jsx(\"div\",{className:\"video-placeholder large\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"placeholder-text\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"\\u8BF7\\u4ECE\\u5DE6\\u4FA7\\u9009\\u62E9\\u4E00\\u4E2A\\u53E5\\u5B50\"}),/*#__PURE__*/_jsx(\"p\",{children:\"\\u9009\\u62E9\\u540E\\u5C06\\u5728\\u6B64\\u5904\\u9884\\u89C8\\u89C6\\u9891\"})]})})]})]})]})]});};// 押韵游戏组件\nconst RhymeGamePage=_ref3=>{let{API_BASE_URL,apiStatus,formatTime,formatEpisode}=_ref3;const[gameStarted,setGameStarted]=useState(false);const[currentPrompts,setCurrentPrompts]=useState([]);const[loadingPrompts,setLoadingPrompts]=useState(false);const[gameLog,setGameLog]=useState([]);const[currentSentence,setCurrentSentence]=useState(null);const[nextOptions,setNextOptions]=useState([]);const[loadingNextOptions,setLoadingNextOptions]=useState(false);const[gameError,setGameError]=useState(null);const[videoUrl,setVideoUrl]=useState('');const[isVideoLoading,setIsVideoLoading]=useState(false);const[selectedOption,setSelectedOption]=useState(null);const[isExportingVideo,setIsExportingVideo]=useState(false);const[clipUrls,setClipUrls]=useState([]);const[isConfirmMode,setIsConfirmMode]=useState(false);// 获取随机提示句子\nconst fetchRandomPrompts=async()=>{setLoadingPrompts(true);setGameError(null);try{const response=await axios.get(`${API_BASE_URL}/api/random_sentences`,{params:{count:8}});if(response.data&&response.data.sentences){setCurrentPrompts(response.data.sentences);}else{setGameError('获取提示句子失败');}}catch(error){console.error('获取提示句子错误:',error);setGameError('无法获取提示句子，请确保API服务正常运行');}finally{setLoadingPrompts(false);}};// 刷新随机提示\nconst refreshRandomPrompts=()=>{if(apiStatus==='connected'&&!loadingPrompts){fetchRandomPrompts();}};// 生成视频片段\nconst generateVideoClip=async subtitle=>{setIsVideoLoading(true);setVideoUrl('');setGameError(null);try{const response=await axios.post(`${API_BASE_URL}/api/generate_clip`,{episode:subtitle.episode,start_time:subtitle.start_seconds,end_time:subtitle.end_seconds,context_seconds:2});if(response.data.success){const clipUrl=`${API_BASE_URL}${response.data.video_url}`;setVideoUrl(clipUrl);return clipUrl;}else{setGameError('生成视频片段失败');return null;}}catch(error){console.error('生成视频片段出错:',error);setGameError('视频服务出现错误，请确保视频文件存在且可访问');return null;}finally{setIsVideoLoading(false);}};// 选择开始句子\nconst selectStartSentence=prompt=>{setSelectedOption(prompt);setIsConfirmMode(true);generateVideoClip(prompt);};// 确认选择开始句子\nconst confirmStartSentence=()=>{const sentence=selectedOption;if(!sentence)return;setCurrentSentence(sentence);setGameLog([{...sentence,step:1,clipUrl:videoUrl}]);setClipUrls([...clipUrls,videoUrl]);setGameStarted(true);fetchRhymingOptions(sentence.text);setIsConfirmMode(false);setSelectedOption(null);};// 取消选择\nconst cancelSelection=()=>{setIsConfirmMode(false);setSelectedOption(null);setVideoUrl('');};// 选择下一个句子\nconst selectNextSentence=option=>{setSelectedOption(option);setIsConfirmMode(true);generateVideoClip(option);};// 确认选择下一个句子\nconst confirmNextSentence=()=>{const sentence=selectedOption;if(!sentence)return;setCurrentSentence(sentence);setGameLog([...gameLog,{...sentence,step:gameLog.length+1,clipUrl:videoUrl}]);setClipUrls([...clipUrls,videoUrl]);fetchRhymingOptions(sentence.text);setIsConfirmMode(false);setSelectedOption(null);};// 获取押韵选项\nconst fetchRhymingOptions=async text=>{if(!text)return;setLoadingNextOptions(true);setGameError(null);try{// 获取最后一个字的拼音，用于押韵\nconst lastChar=getLastValidChar(text);if(!lastChar){setGameError('无法识别有效的结尾字符');setLoadingNextOptions(false);return;}console.log(`正在查找与\"${lastChar}\"押韵的句子...`);// 调用押韵API\nconst response=await axios.get(`${API_BASE_URL}/api/rhyming_sentences`,{params:{text:text,min_length:3,max_length:8,limit:8}});if(response.data&&response.data.sentences){console.log(`API返回了 ${response.data.sentences.length} 条押韵结果`);setNextOptions(response.data.sentences);}else{setGameError('获取押韵句子失败：无结果返回');setNextOptions([]);}}catch(error){console.error('获取押韵句子错误:',error);setGameError(`查询错误: ${error.message}`);setNextOptions([]);}finally{setLoadingNextOptions(false);}};// 获取最后一个有效字符（排除语气词）\nconst getLastValidChar=text=>{if(!text||text.length===0)return null;// 排除常见语气词\nconst cleanText=text.replace(/[啊呢吗吧呀嘛哦哎嗯呐呵呦诶哈哟]$/,'');return cleanText.length>0?cleanText[cleanText.length-1]:null;};// 刷新下一步选项\nconst refreshNextOptions=()=>{if(currentSentence&&!loadingNextOptions){fetchRhymingOptions(currentSentence.text);}};// 回到上一步\nconst goBackOneStep=()=>{if(gameLog.length<=1){// 只有一步，回到选择开始句子\nsetGameStarted(false);setGameLog([]);setCurrentSentence(null);setNextOptions([]);setClipUrls([]);setVideoUrl('');fetchRandomPrompts();}else{// 移除最后一步\nconst newLog=[...gameLog];newLog.pop();setGameLog(newLog);// 更新当前句子和视频\nconst prevSentence=newLog[newLog.length-1];setCurrentSentence(prevSentence);// 更新剪辑URL列表\nconst newClipUrls=[...clipUrls];newClipUrls.pop();setClipUrls(newClipUrls);// 重新获取选项\nfetchRhymingOptions(prevSentence.text);}};// 合并视频并导出\nconst exportMergedVideo=async()=>{if(clipUrls.length===0)return;setIsExportingVideo(true);setGameError(null);try{const response=await axios.post(`${API_BASE_URL}/api/merge_clips`,{clip_urls:clipUrls});if(response.data.success){const mergedVideoUrl=`${API_BASE_URL}${response.data.video_url||response.data.merged_video_url}`;// 创建下载链接\nconst link=document.createElement('a');link.href=mergedVideoUrl;link.download='押韵视频.mp4';link.click();console.log('视频合并成功，已触发下载');}else{setGameError('视频合并失败: '+(response.data.error||'未知错误'));}}catch(error){console.error('视频合并错误:',error);setGameError('视频合并服务出错: '+error.message);}finally{setIsExportingVideo(false);}};// 开始新游戏\nconst startNewGame=()=>{setGameLog([]);fetchRandomPrompts();setGameStarted(false);setCurrentSentence(null);setNextOptions([]);setClipUrls([]);setVideoUrl('');setSelectedOption(null);setIsConfirmMode(false);};// 初始加载时获取随机提示\nuseEffect(()=>{if(apiStatus==='connected'){fetchRandomPrompts();}},[apiStatus]);return/*#__PURE__*/_jsxs(\"div\",{className:\"chain-game-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"game-controls\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:startNewGame,className:\"new-game-btn\",disabled:apiStatus!=='connected',children:\"\\u65B0\\u6E38\\u620F\"}),gameLog.length>0&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"button\",{onClick:goBackOneStep,className:\"back-btn\",disabled:isConfirmMode,children:\"\\u4E0A\\u4E00\\u6B65\"}),/*#__PURE__*/_jsx(\"button\",{onClick:exportMergedVideo,className:\"export-btn\",disabled:gameLog.length<2||isExportingVideo,children:isExportingVideo?'导出中...':'导出押韵视频'})]})]}),gameError&&/*#__PURE__*/_jsx(\"div\",{className:\"game-error\",children:gameError}),/*#__PURE__*/_jsxs(\"div\",{className:\"game-content\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"game-candidates\",children:[!gameStarted?/*#__PURE__*/_jsxs(\"div\",{className:\"start-game-section\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"section-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\u9009\\u62E9\\u5F00\\u59CB\\u53E5\\u5B50\"}),/*#__PURE__*/_jsx(\"button\",{onClick:refreshRandomPrompts,className:\"refresh-btn\",disabled:loadingPrompts||apiStatus!=='connected',children:\"\\u6362\\u4E00\\u6279\"})]}),loadingPrompts?/*#__PURE__*/_jsx(\"div\",{className:\"loading\",children:\"\\u52A0\\u8F7D\\u63D0\\u793A\\u53E5\\u5B50\\u4E2D...\"}):/*#__PURE__*/_jsx(\"ul\",{className:\"prompts-list\",children:currentPrompts.map((prompt,index)=>/*#__PURE__*/_jsxs(\"li\",{onClick:()=>selectStartSentence(prompt),className:selectedOption===prompt?'prompt-item selected':'prompt-item',children:[/*#__PURE__*/_jsx(\"div\",{className:\"prompt-text\",children:prompt.text}),/*#__PURE__*/_jsxs(\"div\",{className:\"prompt-info\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"episode\",children:formatEpisode(prompt.episode)}),/*#__PURE__*/_jsx(\"span\",{className:\"time\",children:formatTime(prompt.start_seconds)}),/*#__PURE__*/_jsx(\"span\",{className:`sentence-type ${analyzeSentenceType(prompt.text)}`,children:analyzeSentenceType(prompt.text)})]})]},index))}),currentPrompts.length===0&&!loadingPrompts&&/*#__PURE__*/_jsxs(\"div\",{className:\"empty-prompts\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"\\u6CA1\\u6709\\u53EF\\u7528\\u7684\\u63D0\\u793A\\u53E5\\u5B50\"}),/*#__PURE__*/_jsx(\"button\",{onClick:refreshRandomPrompts,children:\"\\u91CD\\u65B0\\u83B7\\u53D6\"})]})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"current-sentence-section\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"section-header\",children:/*#__PURE__*/_jsx(\"h2\",{children:\"\\u5F53\\u524D\\u53E5\\u5B50\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"current-sentence\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"sentence-text\",children:currentSentence===null||currentSentence===void 0?void 0:currentSentence.text}),/*#__PURE__*/_jsxs(\"div\",{className:\"sentence-info\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"episode\",children:formatEpisode(currentSentence===null||currentSentence===void 0?void 0:currentSentence.episode)}),/*#__PURE__*/_jsx(\"span\",{className:\"time\",children:formatTime(currentSentence===null||currentSentence===void 0?void 0:currentSentence.start_seconds)})]}),/*#__PURE__*/_jsx(\"div\",{className:\"sentence-type-tag\",children:/*#__PURE__*/_jsx(\"span\",{className:analyzeSentenceType(currentSentence===null||currentSentence===void 0?void 0:currentSentence.text),children:analyzeSentenceType(currentSentence===null||currentSentence===void 0?void 0:currentSentence.text)})})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"next-options-section\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"section-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\u62BC\\u97F5\\u9009\\u9879\"}),/*#__PURE__*/_jsx(\"button\",{onClick:refreshNextOptions,className:\"refresh-btn\",disabled:loadingNextOptions,children:\"\\u6362\\u4E00\\u6279\"})]}),loadingNextOptions?/*#__PURE__*/_jsx(\"div\",{className:\"loading\",children:\"\\u52A0\\u8F7D\\u62BC\\u97F5\\u53E5\\u5B50\\u4E2D...\"}):/*#__PURE__*/_jsx(\"ul\",{className:\"options-list\",children:nextOptions.map((option,index)=>/*#__PURE__*/_jsxs(\"li\",{onClick:()=>selectNextSentence(option),className:selectedOption===option?'option-item selected':'option-item',children:[/*#__PURE__*/_jsx(\"div\",{className:\"option-text\",children:option.text}),/*#__PURE__*/_jsxs(\"div\",{className:\"option-info\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"episode\",children:formatEpisode(option.episode)}),/*#__PURE__*/_jsx(\"span\",{className:\"time\",children:formatTime(option.start_seconds)}),/*#__PURE__*/_jsx(\"span\",{className:`sentence-type ${analyzeSentenceType(option.text)}`,children:analyzeSentenceType(option.text)})]})]},index))}),nextOptions.length===0&&!loadingNextOptions&&/*#__PURE__*/_jsxs(\"div\",{className:\"empty-options\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"\\u6CA1\\u6709\\u627E\\u5230\\u5408\\u9002\\u7684\\u62BC\\u97F5\\u53E5\\u5B50\"}),/*#__PURE__*/_jsx(\"button\",{onClick:startNewGame,children:\"\\u91CD\\u65B0\\u5F00\\u59CB\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"game-log-section\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\u62BC\\u97F5\\u8BB0\\u5F55\"}),gameLog.length>0?/*#__PURE__*/_jsx(\"ol\",{className:\"game-log-list\",children:gameLog.map((log,index)=>/*#__PURE__*/_jsxs(\"li\",{className:\"log-item\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"log-text\",children:log.text}),/*#__PURE__*/_jsxs(\"div\",{className:\"log-info\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"episode\",children:formatEpisode(log.episode)}),/*#__PURE__*/_jsx(\"span\",{className:\"time\",children:formatTime(log.start_seconds)}),log.clipUrl&&/*#__PURE__*/_jsx(\"span\",{className:\"clip-info\",children:/*#__PURE__*/_jsx(\"i\",{className:\"video-icon\",children:\"\\uD83C\\uDFAC\"})})]})]},index))}):/*#__PURE__*/_jsx(\"div\",{className:\"empty-log\",children:\"\\u5C1A\\u672A\\u5F00\\u59CB\\u6E38\\u620F\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"game-video-preview\",children:[isConfirmMode&&/*#__PURE__*/_jsxs(\"div\",{className:\"confirm-section\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"selected-sentence\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"selected-text\",children:selectedOption===null||selectedOption===void 0?void 0:selectedOption.text}),/*#__PURE__*/_jsxs(\"div\",{className:\"selected-info\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"episode\",children:formatEpisode(selectedOption===null||selectedOption===void 0?void 0:selectedOption.episode)}),/*#__PURE__*/_jsx(\"span\",{className:\"time\",children:formatTime(selectedOption===null||selectedOption===void 0?void 0:selectedOption.start_seconds)})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"video-preview\",children:isVideoLoading?/*#__PURE__*/_jsx(\"div\",{className:\"loading-video\",children:\"\\u751F\\u6210\\u89C6\\u9891\\u7247\\u6BB5\\u4E2D\\uFF0C\\u8BF7\\u7A0D\\u5019...\"}):videoUrl?/*#__PURE__*/_jsx(\"video\",{controls:true,autoPlay:true,className:\"video-element\",src:videoUrl}):/*#__PURE__*/_jsx(\"div\",{className:\"video-placeholder\",children:\"\\u51C6\\u5907\\u751F\\u6210\\u89C6\\u9891\\u7247\\u6BB5...\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"confirm-buttons\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"confirm-btn\",onClick:gameStarted?confirmNextSentence:confirmStartSentence,disabled:isVideoLoading||!videoUrl,children:\"\\u786E\\u8BA4\\u9009\\u62E9\"}),/*#__PURE__*/_jsx(\"button\",{className:\"cancel-btn\",onClick:cancelSelection,children:\"\\u53D6\\u6D88\\u9009\\u62E9\"})]})]}),!isConfirmMode&&/*#__PURE__*/_jsxs(\"div\",{className:\"video-section\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\u89C6\\u9891\\u9884\\u89C8\"}),isVideoLoading?/*#__PURE__*/_jsx(\"div\",{className:\"loading-video\",children:\"\\u751F\\u6210\\u89C6\\u9891\\u7247\\u6BB5\\u4E2D\\uFF0C\\u8BF7\\u7A0D\\u5019...\"}):videoUrl?/*#__PURE__*/_jsx(\"video\",{controls:true,autoPlay:true,className:\"video-element\",src:videoUrl}):/*#__PURE__*/_jsx(\"div\",{className:\"video-placeholder large\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"placeholder-text\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"\\u8BF7\\u4ECE\\u5DE6\\u4FA7\\u9009\\u62E9\\u4E00\\u4E2A\\u53E5\\u5B50\"}),/*#__PURE__*/_jsx(\"p\",{children:\"\\u9009\\u62E9\\u540E\\u5C06\\u5728\\u6B64\\u5904\\u9884\\u89C8\\u89C6\\u9891\"})]})})]})]})]})]});};// 分析句子类型 - 全局辅助函数\nconst analyzeSentenceType=text=>{if(!text)return'普通句';// 判断是否为问句\nif(text.includes('?')||text.includes('？')||text.includes('吗')||text.includes('呢')){return'疑问句';}// 判断是否为命令句\nconst commandWords=['去','来','给我','快','立刻','马上','传'];if(commandWords.some(word=>text.includes(word))){return'命令句';}// 判断情感色彩\nconst positiveWords=['好','愿意','可以','是','对','喜欢','爱','高兴'];const negativeWords=['不','没','别','莫','拒绝','难过','恨','讨厌'];if(positiveWords.some(word=>text.includes(word))){return'积极句';}if(negativeWords.some(word=>text.includes(word))){return'消极句';}return'普通句';};// 奇妙对话组件\nconst DialogueGamePage=_ref4=>{let{API_BASE_URL,apiStatus,formatTime,formatEpisode}=_ref4;const[gameStarted,setGameStarted]=useState(false);const[currentPrompts,setCurrentPrompts]=useState([]);const[loadingPrompts,setLoadingPrompts]=useState(false);const[gameLog,setGameLog]=useState([]);const[currentSentence,setCurrentSentence]=useState(null);const[nextOptions,setNextOptions]=useState([]);const[loadingNextOptions,setLoadingNextOptions]=useState(false);const[gameError,setGameError]=useState(null);const[videoUrl,setVideoUrl]=useState('');const[isVideoLoading,setIsVideoLoading]=useState(false);const[selectedOption,setSelectedOption]=useState(null);const[isExportingVideo,setIsExportingVideo]=useState(false);const[clipUrls,setClipUrls]=useState([]);const[isConfirmMode,setIsConfirmMode]=useState(false);// 获取随机提示句子\nconst fetchRandomPrompts=async()=>{setLoadingPrompts(true);setGameError(null);try{const response=await axios.get(`${API_BASE_URL}/api/random_sentences`,{params:{count:8}});if(response.data&&response.data.sentences){setCurrentPrompts(response.data.sentences);}else{setGameError('获取提示句子失败');}}catch(error){console.error('获取提示句子错误:',error);setGameError('无法获取提示句子，请确保API服务正常运行');}finally{setLoadingPrompts(false);}};// 刷新随机提示\nconst refreshRandomPrompts=()=>{if(apiStatus==='connected'&&!loadingPrompts){fetchRandomPrompts();}};// 生成视频片段\nconst generateVideoClip=async subtitle=>{setIsVideoLoading(true);setVideoUrl('');setGameError(null);try{const response=await axios.post(`${API_BASE_URL}/api/generate_clip`,{episode:subtitle.episode,start_time:subtitle.start_seconds,end_time:subtitle.end_seconds,context_seconds:2});if(response.data.success){const clipUrl=`${API_BASE_URL}${response.data.video_url}`;setVideoUrl(clipUrl);return clipUrl;}else{setGameError('生成视频片段失败');return null;}}catch(error){console.error('生成视频片段出错:',error);setGameError('视频服务出现错误，请确保视频文件存在且可访问');return null;}finally{setIsVideoLoading(false);}};// 选择开始句子\nconst selectStartSentence=prompt=>{setSelectedOption(prompt);setIsConfirmMode(true);generateVideoClip(prompt);};// 确认选择开始句子\nconst confirmStartSentence=()=>{const sentence=selectedOption;if(!sentence)return;setCurrentSentence(sentence);setGameLog([{...sentence,step:1,clipUrl:videoUrl}]);setClipUrls([...clipUrls,videoUrl]);setGameStarted(true);fetchDialogueResponses(sentence);setIsConfirmMode(false);setSelectedOption(null);};// 取消选择\nconst cancelSelection=()=>{setIsConfirmMode(false);setSelectedOption(null);setVideoUrl('');};// 选择下一个句子\nconst selectNextSentence=option=>{setSelectedOption(option);setIsConfirmMode(true);generateVideoClip(option);};// 确认选择下一个句子\nconst confirmNextSentence=()=>{const sentence=selectedOption;if(!sentence)return;setCurrentSentence(sentence);setGameLog([...gameLog,{...sentence,step:gameLog.length+1,clipUrl:videoUrl}]);setClipUrls([...clipUrls,videoUrl]);fetchDialogueResponses(sentence);setIsConfirmMode(false);setSelectedOption(null);};// 获取对话回应选项\nconst fetchDialogueResponses=async sentence=>{if(!sentence)return;setLoadingNextOptions(true);setGameError(null);try{console.log(`正在查找对\"${sentence.text}\"的有趣回应...`);// 调用后端API查询对话回应\nconst response=await axios.post(`${API_BASE_URL}/api/dialogue_responses`,{sentence_id:sentence.id,sentence_text:sentence.text,episode:sentence.episode});if(response.data&&response.data.results){console.log(`API返回了 ${response.data.results.length} 条对话回应`);setNextOptions(response.data.results);}else{setGameError('获取对话回应失败：无结果返回');setNextOptions([]);}}catch(error){console.error('获取对话回应错误:',error);setGameError(`获取对话回应失败: ${error.message}`);setNextOptions([]);}finally{setLoadingNextOptions(false);}};// 刷新下一步选项\nconst refreshNextOptions=()=>{if(currentSentence&&!loadingNextOptions){fetchDialogueResponses(currentSentence);}};// 回到上一步\nconst goBackOneStep=()=>{if(gameLog.length<=1){// 只有一步，回到选择开始句子\nsetGameStarted(false);setGameLog([]);setCurrentSentence(null);setNextOptions([]);setClipUrls([]);setVideoUrl('');fetchRandomPrompts();}else{// 移除最后一步\nconst newLog=[...gameLog];newLog.pop();setGameLog(newLog);// 更新当前句子和视频\nconst prevSentence=newLog[newLog.length-1];setCurrentSentence(prevSentence);// 更新剪辑URL列表\nconst newClipUrls=[...clipUrls];newClipUrls.pop();setClipUrls(newClipUrls);// 重新获取选项\nfetchDialogueResponses(prevSentence);}};// 合并视频并导出\nconst exportMergedVideo=async()=>{if(clipUrls.length===0)return;setIsExportingVideo(true);setGameError(null);try{const response=await axios.post(`${API_BASE_URL}/api/merge_clips`,{clip_urls:clipUrls});if(response.data.success){const mergedVideoUrl=`${API_BASE_URL}${response.data.video_url||response.data.merged_video_url}`;// 创建下载链接\nconst link=document.createElement('a');link.href=mergedVideoUrl;link.download='奇妙对话视频.mp4';link.click();console.log('视频合并成功，已触发下载');}else{setGameError('视频合并失败: '+(response.data.error||'未知错误'));}}catch(error){console.error('视频合并错误:',error);setGameError('视频合并服务出错: '+error.message);}finally{setIsExportingVideo(false);}};// 开始新游戏\nconst startNewGame=()=>{setGameLog([]);fetchRandomPrompts();setGameStarted(false);setCurrentSentence(null);setNextOptions([]);setClipUrls([]);setVideoUrl('');setSelectedOption(null);setIsConfirmMode(false);};// 初始加载时获取随机提示\nuseEffect(()=>{if(apiStatus==='connected'){fetchRandomPrompts();}},[apiStatus]);return/*#__PURE__*/_jsxs(\"div\",{className:\"chain-game-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"game-controls\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:startNewGame,className:\"new-game-btn\",disabled:apiStatus!=='connected',children:\"\\u65B0\\u6E38\\u620F\"}),gameLog.length>0&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"button\",{onClick:goBackOneStep,className:\"back-btn\",disabled:isConfirmMode,children:\"\\u4E0A\\u4E00\\u6B65\"}),/*#__PURE__*/_jsx(\"button\",{onClick:exportMergedVideo,className:\"export-btn\",disabled:gameLog.length<2||isExportingVideo,children:isExportingVideo?'导出中...':'导出对话视频'})]})]}),gameError&&/*#__PURE__*/_jsx(\"div\",{className:\"game-error\",children:gameError}),/*#__PURE__*/_jsxs(\"div\",{className:\"game-content\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"game-candidates\",children:[!gameStarted?/*#__PURE__*/_jsxs(\"div\",{className:\"start-game-section\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"section-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\u9009\\u62E9\\u5F00\\u59CB\\u53E5\\u5B50\"}),/*#__PURE__*/_jsx(\"button\",{onClick:refreshRandomPrompts,className:\"refresh-btn\",disabled:loadingPrompts||apiStatus!=='connected',children:\"\\u6362\\u4E00\\u6279\"})]}),loadingPrompts?/*#__PURE__*/_jsx(\"div\",{className:\"loading\",children:\"\\u52A0\\u8F7D\\u63D0\\u793A\\u53E5\\u5B50\\u4E2D...\"}):/*#__PURE__*/_jsx(\"ul\",{className:\"prompts-list\",children:currentPrompts.map((prompt,index)=>/*#__PURE__*/_jsxs(\"li\",{onClick:()=>selectStartSentence(prompt),className:selectedOption===prompt?'prompt-item selected':'prompt-item',children:[/*#__PURE__*/_jsx(\"div\",{className:\"prompt-text\",children:prompt.text}),/*#__PURE__*/_jsxs(\"div\",{className:\"prompt-info\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"episode\",children:formatEpisode(prompt.episode)}),/*#__PURE__*/_jsx(\"span\",{className:\"time\",children:formatTime(prompt.start_seconds)}),/*#__PURE__*/_jsx(\"span\",{className:`sentence-type ${analyzeSentenceType(prompt.text)}`,children:analyzeSentenceType(prompt.text)})]})]},index))}),currentPrompts.length===0&&!loadingPrompts&&/*#__PURE__*/_jsxs(\"div\",{className:\"empty-prompts\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"\\u6CA1\\u6709\\u53EF\\u7528\\u7684\\u63D0\\u793A\\u53E5\\u5B50\"}),/*#__PURE__*/_jsx(\"button\",{onClick:refreshRandomPrompts,children:\"\\u91CD\\u65B0\\u83B7\\u53D6\"})]})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"current-sentence-section\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"section-header\",children:/*#__PURE__*/_jsx(\"h2\",{children:\"\\u5F53\\u524D\\u53E5\\u5B50\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"current-sentence\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"sentence-text\",children:currentSentence===null||currentSentence===void 0?void 0:currentSentence.text}),/*#__PURE__*/_jsxs(\"div\",{className:\"sentence-info\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"episode\",children:formatEpisode(currentSentence===null||currentSentence===void 0?void 0:currentSentence.episode)}),/*#__PURE__*/_jsx(\"span\",{className:\"time\",children:formatTime(currentSentence===null||currentSentence===void 0?void 0:currentSentence.start_seconds)})]}),/*#__PURE__*/_jsx(\"div\",{className:\"sentence-type-tag\",children:/*#__PURE__*/_jsx(\"span\",{className:analyzeSentenceType(currentSentence===null||currentSentence===void 0?void 0:currentSentence.text),children:analyzeSentenceType(currentSentence===null||currentSentence===void 0?void 0:currentSentence.text)})})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"next-options-section\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"section-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\u6709\\u8DA3\\u56DE\\u5E94\"}),/*#__PURE__*/_jsx(\"button\",{onClick:refreshNextOptions,className:\"refresh-btn\",disabled:loadingNextOptions,children:\"\\u6362\\u4E00\\u6279\"})]}),loadingNextOptions?/*#__PURE__*/_jsx(\"div\",{className:\"loading\",children:\"\\u67E5\\u627E\\u6709\\u8DA3\\u56DE\\u5E94\\u4E2D...\"}):/*#__PURE__*/_jsx(\"ul\",{className:\"options-list\",children:nextOptions.map((option,index)=>/*#__PURE__*/_jsxs(\"li\",{onClick:()=>selectNextSentence(option),className:selectedOption===option?'option-item selected':'option-item',children:[/*#__PURE__*/_jsx(\"div\",{className:\"option-text\",children:option.text}),/*#__PURE__*/_jsxs(\"div\",{className:\"option-info\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"episode\",children:formatEpisode(option.episode)}),/*#__PURE__*/_jsx(\"span\",{className:\"time\",children:formatTime(option.start_seconds)}),/*#__PURE__*/_jsx(\"span\",{className:`sentence-type ${analyzeSentenceType(option.text)}`,children:analyzeSentenceType(option.text)})]})]},index))}),nextOptions.length===0&&!loadingNextOptions&&/*#__PURE__*/_jsxs(\"div\",{className:\"empty-options\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"\\u6CA1\\u6709\\u627E\\u5230\\u5408\\u9002\\u7684\\u56DE\\u5E94\\u53E5\\u5B50\"}),/*#__PURE__*/_jsx(\"button\",{onClick:startNewGame,children:\"\\u91CD\\u65B0\\u5F00\\u59CB\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"game-log-section\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\u5BF9\\u8BDD\\u8BB0\\u5F55\"}),gameLog.length>0?/*#__PURE__*/_jsx(\"ol\",{className:\"game-log-list\",children:gameLog.map((log,index)=>/*#__PURE__*/_jsxs(\"li\",{className:\"log-item\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"log-text\",children:log.text}),/*#__PURE__*/_jsxs(\"div\",{className:\"log-info\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"episode\",children:formatEpisode(log.episode)}),/*#__PURE__*/_jsx(\"span\",{className:\"time\",children:formatTime(log.start_seconds)}),log.clipUrl&&/*#__PURE__*/_jsx(\"span\",{className:\"clip-info\",children:/*#__PURE__*/_jsx(\"i\",{className:\"video-icon\",children:\"\\uD83C\\uDFAC\"})})]})]},index))}):/*#__PURE__*/_jsx(\"div\",{className:\"empty-log\",children:\"\\u5C1A\\u672A\\u5F00\\u59CB\\u5BF9\\u8BDD\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"game-video-preview\",children:[isConfirmMode&&/*#__PURE__*/_jsxs(\"div\",{className:\"confirm-section\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"selected-sentence\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"selected-text\",children:selectedOption===null||selectedOption===void 0?void 0:selectedOption.text}),/*#__PURE__*/_jsxs(\"div\",{className:\"selected-info\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"episode\",children:formatEpisode(selectedOption===null||selectedOption===void 0?void 0:selectedOption.episode)}),/*#__PURE__*/_jsx(\"span\",{className:\"time\",children:formatTime(selectedOption===null||selectedOption===void 0?void 0:selectedOption.start_seconds)})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"video-preview\",children:isVideoLoading?/*#__PURE__*/_jsx(\"div\",{className:\"loading-video\",children:\"\\u751F\\u6210\\u89C6\\u9891\\u7247\\u6BB5\\u4E2D\\uFF0C\\u8BF7\\u7A0D\\u5019...\"}):videoUrl?/*#__PURE__*/_jsx(\"video\",{controls:true,autoPlay:true,className:\"video-element\",src:videoUrl}):/*#__PURE__*/_jsx(\"div\",{className:\"video-placeholder\",children:\"\\u51C6\\u5907\\u751F\\u6210\\u89C6\\u9891\\u7247\\u6BB5...\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"confirm-buttons\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"confirm-btn\",onClick:gameStarted?confirmNextSentence:confirmStartSentence,disabled:isVideoLoading||!videoUrl,children:\"\\u786E\\u8BA4\\u9009\\u62E9\"}),/*#__PURE__*/_jsx(\"button\",{className:\"cancel-btn\",onClick:cancelSelection,children:\"\\u53D6\\u6D88\\u9009\\u62E9\"})]})]}),!isConfirmMode&&/*#__PURE__*/_jsxs(\"div\",{className:\"video-section\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\u89C6\\u9891\\u9884\\u89C8\"}),isVideoLoading?/*#__PURE__*/_jsx(\"div\",{className:\"loading-video\",children:\"\\u751F\\u6210\\u89C6\\u9891\\u7247\\u6BB5\\u4E2D\\uFF0C\\u8BF7\\u7A0D\\u5019...\"}):videoUrl?/*#__PURE__*/_jsx(\"video\",{controls:true,autoPlay:true,className:\"video-element\",src:videoUrl}):/*#__PURE__*/_jsx(\"div\",{className:\"video-placeholder large\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"placeholder-text\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"\\u8BF7\\u4ECE\\u5DE6\\u4FA7\\u9009\\u62E9\\u4E00\\u4E2A\\u53E5\\u5B50\"}),/*#__PURE__*/_jsx(\"p\",{children:\"\\u9009\\u62E9\\u540E\\u5C06\\u5728\\u6B64\\u5904\\u9884\\u89C8\\u89C6\\u9891\"})]})})]})]})]})]});};function App(){const[query,setQuery]=useState('');const[results,setResults]=useState([]);const[loading,setLoading]=useState(false);const[error,setError]=useState('');const[selectedResult,setSelectedResult]=useState(null);const[videoUrl,setVideoUrl]=useState('');const[apiStatus,setApiStatus]=useState({loading:true,error:null,data:null});const[activePage,setActivePage]=useState('search');// 'search' 或 'chain-game' or 'rhyme-game' or 'dialogue-game'\n// API 相关配置\nconst API_BASE_URL='http://localhost:8089';// 检查API状态\nuseEffect(()=>{const checkApiStatus=async()=>{try{const response=await fetch(`${API_BASE_URL}/api/status`);if(response.ok){const data=await response.json();setApiStatus({loading:false,error:null,data});console.log(\"API状态:\",data);}else{setApiStatus({loading:false,error:'无法连接到API服务',data:null});}}catch(error){console.error(\"API连接错误:\",error);setApiStatus({loading:false,error:'无法连接到API服务',data:null});}};checkApiStatus();},[]);const handleSearch=async e=>{e.preventDefault();if(!query.trim()){setError('请输入搜索内容');return;}setLoading(true);setError('');setResults([]);setSelectedResult(null);setVideoUrl('');try{// 构建查询URL\nconst queryParams=new URLSearchParams({query:query.trim()}).toString();const response=await fetch(`${API_BASE_URL}/api/search?${queryParams}`);if(response.ok){const data=await response.json();setResults(data.results||[]);if(data.results&&data.results.length===0){setError('没有找到匹配的结果');}}else{const errorData=await response.json();setError(errorData.error||'搜索失败');}}catch(error){console.error('搜索失败:',error);setError('搜索请求失败，请检查网络连接');}finally{setLoading(false);}};const handleGenerateClip=async result=>{if(!result)return;setSelectedResult(result);setLoading(true);setError('');setVideoUrl('');try{const response=await fetch(`${API_BASE_URL}/api/generate_clip`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({episode:result.episode,start_time:result.start_seconds,end_time:result.end_seconds,context_seconds:3// 上下文秒数\n})});if(response.ok){const data=await response.json();if(data.success){// 确保视频URL包含完整的基础URL\nconst fullVideoUrl=data.video_url.startsWith('http')?data.video_url:`${API_BASE_URL}${data.video_url}`;setVideoUrl(fullVideoUrl);}else{setError(data.error||'视频片段生成失败');}}else{const errorData=await response.json();setError(errorData.error||'请求失败');}}catch(error){console.error('生成视频片段失败:',error);setError('请求失败，请检查网络连接');}finally{setLoading(false);}};// 格式化时间显示\nconst formatTime=seconds=>{if(seconds===undefined||seconds===null)return'00:00:00';const hours=Math.floor(seconds/3600);const mins=Math.floor(seconds%3600/60);const secs=Math.floor(seconds%60);return`${hours.toString().padStart(2,'0')}:${mins.toString().padStart(2,'0')}:${secs.toString().padStart(2,'0')}`;};// 格式化集数显示\nconst formatEpisode=episode=>{if(!episode)return'';return episode.replace('后宫·甄嬛传','第')+'集';};// 高亮显示匹配文本\nconst highlightText=(text,query)=>{if(!query||!text)return text;try{const regex=new RegExp(query,'gi');return text.replace(regex,match=>`<mark>${match}</mark>`);}catch(e){return text;}};// 切换页面\nconst switchPage=page=>{setActivePage(page);};return/*#__PURE__*/_jsxs(\"div\",{className:\"App\",children:[/*#__PURE__*/_jsxs(\"header\",{className:\"App-header\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"\\u5B57\\u5E55\\u67E5\\u8BE2\\u4E0E\\u89C6\\u9891\\u751F\\u6210\\u7CFB\\u7EDF\"}),/*#__PURE__*/_jsx(\"div\",{className:`api-status ${apiStatus.loading?'checking':apiStatus.error?'error':'connected'}`,children:apiStatus.loading?'检查API连接中...':apiStatus.error?'无法连接到API服务，请确保后端服务已启动':apiStatus.data?`API服务已连接 (已加载 ${apiStatus.data.loaded_episodes} 集, ${apiStatus.data.total_subtitles} 条字幕)`:'API状态未知'}),/*#__PURE__*/_jsx(\"nav\",{className:\"main-nav\",children:/*#__PURE__*/_jsxs(\"ul\",{children:[/*#__PURE__*/_jsx(\"li\",{className:activePage==='search'?'active':'',children:/*#__PURE__*/_jsx(\"button\",{onClick:()=>switchPage('search'),children:\"\\u5B57\\u5E55\\u641C\\u7D22\"})}),/*#__PURE__*/_jsx(\"li\",{className:activePage==='chain-game'?'active':'',children:/*#__PURE__*/_jsx(\"button\",{onClick:()=>switchPage('chain-game'),children:\"\\u5B57\\u5E55\\u63A5\\u9F99\"})}),/*#__PURE__*/_jsx(\"li\",{className:activePage==='rhyme-game'?'active':'',children:/*#__PURE__*/_jsx(\"button\",{onClick:()=>switchPage('rhyme-game'),children:\"\\u5B57\\u5E55\\u62BC\\u97F5\"})}),/*#__PURE__*/_jsx(\"li\",{className:activePage==='dialogue-game'?'active':'',children:/*#__PURE__*/_jsx(\"button\",{onClick:()=>switchPage('dialogue-game'),children:\"\\u5947\\u5999\\u5BF9\\u8BDD\"})})]})})]}),/*#__PURE__*/_jsxs(\"main\",{className:\"App-main\",children:[activePage==='search'&&/*#__PURE__*/_jsx(SearchPage,{API_BASE_URL:API_BASE_URL,query:query,setQuery:setQuery,searchResults:results,setSearchResults:setResults,loading:loading,setLoading:setLoading,apiStatus:apiStatus.loading?'checking':apiStatus.error?'error':'connected',error:error,setError:setError,selectedResult:selectedResult,setSelectedResult:setSelectedResult,videoUrl:videoUrl,setVideoUrl:setVideoUrl,isVideoLoading:loading,setIsVideoLoading:setLoading,handleSearch:handleSearch,handleGenerateClip:handleGenerateClip,formatTime:formatTime,formatEpisode:formatEpisode,highlightText:highlightText}),activePage==='chain-game'&&/*#__PURE__*/_jsx(ChainGamePage,{API_BASE_URL:API_BASE_URL,apiStatus:apiStatus.loading?'checking':apiStatus.error?'error':'connected',formatTime:formatTime,formatEpisode:formatEpisode}),activePage==='rhyme-game'&&/*#__PURE__*/_jsx(RhymeGamePage,{API_BASE_URL:API_BASE_URL,apiStatus:apiStatus.loading?'checking':apiStatus.error?'error':'connected',formatTime:formatTime,formatEpisode:formatEpisode}),activePage==='dialogue-game'&&/*#__PURE__*/_jsx(DialogueGamePage,{API_BASE_URL:API_BASE_URL,apiStatus:apiStatus.loading?'checking':apiStatus.error?'error':'connected',formatTime:formatTime,formatEpisode:formatEpisode})]}),/*#__PURE__*/_jsx(\"footer\",{className:\"App-footer\",children:/*#__PURE__*/_jsx(\"p\",{children:\"\\u5B57\\u5E55\\u6570\\u636E\\u6765\\u6E90\\u4E8E\\u300A\\u540E\\u5BAB\\xB7\\u7504\\u5B1B\\u4F20\\u300B\"})})]});}export default App;","map":{"version":3,"names":["React","useState","useEffect","axios","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","SearchPage","_ref","API_BASE_URL","query","setQuery","searchResults","setSearchResults","loading","setLoading","apiStatus","error","setError","selectedResult","setSelectedResult","videoUrl","setVideoUrl","isVideoLoading","setIsVideoLoading","handleSearch","handleGenerateClip","formatTime","formatEpisode","highlightText","children","className","onSubmit","type","value","onChange","e","target","placeholder","disabled","length","map","result","index","onClick","episode","start_seconds","end_seconds","dangerouslySetInnerHTML","__html","text","controls","autoPlay","src","ChainGamePage","_ref2","gameStarted","setGameStarted","currentPrompts","setCurrentPrompts","loadingPrompts","setLoadingPrompts","gameLog","setGameLog","currentSentence","setCurrentSentence","nextOptions","setNextOptions","loadingNextOptions","setLoadingNextOptions","gameError","setGameError","selectedOption","setSelectedOption","isExportingVideo","setIsExportingVideo","clipUrls","setClipUrls","isConfirmMode","setIsConfirmMode","fetchRandomPrompts","response","get","params","count","data","sentences","console","refreshRandomPrompts","generateVideoClip","subtitle","post","start_time","end_time","context_seconds","success","clipUrl","video_url","selectStartSentence","prompt","confirmStartSentence","sentence","step","fetchNextOptions","cancelSelection","selectNextSentence","option","confirmNextSentence","lastChar","getLastValidChar","log","fetch","encodeURIComponent","ok","Error","status","json","results","filteredResults","filter","item","cleanText","replace","fallbackResponse","fallbackData","manualFilteredResults","startsWith","shuffled","sort","Math","random","slice","message","refreshNextOptions","goBackOneStep","newLog","newClipUrls","exportMergedVideo","selectedClipUrls","entry","url","clip_urls","a","document","createElement","href","merged_video_url","download","body","appendChild","click","removeChild","startNewGame","analyzeSentenceType","RhymeGamePage","_ref3","fetchRhymingOptions","min_length","max_length","limit","pop","prevSentence","mergedVideoUrl","link","includes","commandWords","some","word","positiveWords","negativeWords","DialogueGamePage","_ref4","fetchDialogueResponses","sentence_id","id","sentence_text","App","setResults","setApiStatus","activePage","setActivePage","checkApiStatus","preventDefault","trim","queryParams","URLSearchParams","toString","errorData","method","headers","JSON","stringify","fullVideoUrl","seconds","undefined","hours","floor","mins","secs","padStart","regex","RegExp","match","switchPage","page","loaded_episodes","total_subtitles"],"sources":["/Users/h0270/Documents/code/ai-vedio/create_video/subtitle-search-app/src/App.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport './App.css';\nimport axios from 'axios';\n\n// 子页面组件\nconst SearchPage = ({ \n  API_BASE_URL, \n  query, \n  setQuery, \n  searchResults,\n  setSearchResults,\n  loading,\n  setLoading,\n  apiStatus,\n  error,\n  setError,\n  selectedResult,\n  setSelectedResult,\n  videoUrl,\n  setVideoUrl,\n  isVideoLoading,\n  setIsVideoLoading,\n  handleSearch,\n  handleGenerateClip,\n  formatTime,\n  formatEpisode,\n  highlightText\n}) => {\n  return (\n    <>\n      <section className=\"search-area\">\n        <form onSubmit={handleSearch}>\n          <div className=\"search-box\">\n            <input\n              type=\"text\"\n              value={query}\n              onChange={(e) => setQuery(e.target.value)}\n              placeholder=\"输入要搜索的字幕内容...\"\n              disabled={apiStatus !== 'connected'}\n            />\n            <button \n              type=\"submit\" \n              disabled={loading || apiStatus !== 'connected'}\n            >\n              {loading ? '搜索中...' : '搜索'}\n            </button>\n          </div>\n        </form>\n\n        {error && <div className=\"error-message\">{error}</div>}\n      </section>\n\n      <div className=\"content-area\">\n        <section className=\"results-area\">\n          <h2>搜索结果 {searchResults.length > 0 && `(${searchResults.length})`}</h2>\n          \n          {loading ? (\n            <div className=\"loading\">搜索中，请稍候...</div>\n          ) : (\n            <ul className=\"results-list\">\n              {searchResults.map((result, index) => (\n                <li \n                  key={index} \n                  className={selectedResult === result ? 'selected' : ''}\n                  onClick={() => handleGenerateClip(result)}\n                >\n                  <div className=\"result-header\">\n                    <span className=\"episode\">{formatEpisode(result.episode)}</span>\n                    <span className=\"time\">{formatTime(result.start_seconds)} - {formatTime(result.end_seconds)}</span>\n                  </div>\n                  <div \n                    className=\"subtitle-text\"\n                    dangerouslySetInnerHTML={{__html: highlightText(result.text, query)}}\n                  />\n                </li>\n              ))}\n            </ul>\n          )}\n        </section>\n\n        <section className=\"video-area\">\n          <h2>视频播放</h2>\n          {selectedResult ? (\n            <div className=\"video-player\">\n              <div className=\"video-info\">\n                <p><strong>集数:</strong> {formatEpisode(selectedResult.episode)}</p>\n                <p><strong>时间段:</strong> {formatTime(selectedResult.start_seconds)} - {formatTime(selectedResult.end_seconds)}</p>\n                <p><strong>字幕内容:</strong> {selectedResult.text}</p>\n              </div>\n              \n              {isVideoLoading ? (\n                <div className=\"loading-video\">生成视频片段中，请稍候...</div>\n              ) : videoUrl ? (\n                <video \n                  controls \n                  autoPlay \n                  className=\"video-element\"\n                  src={videoUrl}\n                />\n              ) : (\n                <div className=\"video-placeholder\">\n                  {selectedResult ? '准备生成视频片段...' : '请从左侧选择一个搜索结果'}\n                </div>\n              )}\n            </div>\n          ) : (\n            <div className=\"video-placeholder\">\n              请从左侧选择一个搜索结果\n            </div>\n          )}\n        </section>\n      </div>\n    </>\n  );\n};\n\n// 成语接龙游戏组件\nconst ChainGamePage = ({ \n  API_BASE_URL, \n  apiStatus,\n  formatTime,\n  formatEpisode\n}) => {\n  const [gameStarted, setGameStarted] = useState(false);\n  const [currentPrompts, setCurrentPrompts] = useState([]);\n  const [loadingPrompts, setLoadingPrompts] = useState(false);\n  const [gameLog, setGameLog] = useState([]);\n  const [currentSentence, setCurrentSentence] = useState(null);\n  const [nextOptions, setNextOptions] = useState([]);\n  const [loadingNextOptions, setLoadingNextOptions] = useState(false);\n  const [gameError, setGameError] = useState(null);\n  const [videoUrl, setVideoUrl] = useState('');\n  const [isVideoLoading, setIsVideoLoading] = useState(false);\n  const [selectedOption, setSelectedOption] = useState(null);\n  const [isExportingVideo, setIsExportingVideo] = useState(false);\n  const [clipUrls, setClipUrls] = useState([]);\n  const [isConfirmMode, setIsConfirmMode] = useState(false);\n\n  // 获取随机提示句子\n  const fetchRandomPrompts = async () => {\n    setLoadingPrompts(true);\n    setGameError(null);\n    \n    try {\n      const response = await axios.get(`${API_BASE_URL}/api/random_sentences`, {\n        params: { count: 8 }\n      });\n      \n      if (response.data && response.data.sentences) {\n        setCurrentPrompts(response.data.sentences);\n      } else {\n        setGameError('获取提示句子失败');\n      }\n    } catch (error) {\n      console.error('获取提示句子错误:', error);\n      setGameError('无法获取提示句子，请确保API服务正常运行');\n    } finally {\n      setLoadingPrompts(false);\n    }\n  };\n\n  // 刷新随机提示\n  const refreshRandomPrompts = () => {\n    if (apiStatus === 'connected' && !loadingPrompts) {\n      fetchRandomPrompts();\n    }\n  };\n\n  // 生成视频片段\n  const generateVideoClip = async (subtitle) => {\n    setIsVideoLoading(true);\n    setVideoUrl('');\n    setGameError(null);\n    \n    try {\n      const response = await axios.post(`${API_BASE_URL}/api/generate_clip`, {\n        episode: subtitle.episode,\n        start_time: subtitle.start_seconds,\n        end_time: subtitle.end_seconds,\n        context_seconds: 2\n      });\n\n      if (response.data.success) {\n        const clipUrl = `${API_BASE_URL}${response.data.video_url}`;\n        setVideoUrl(clipUrl);\n        return clipUrl;\n      } else {\n        setGameError('生成视频片段失败');\n        return null;\n      }\n    } catch (error) {\n      console.error('生成视频片段出错:', error);\n      setGameError('视频服务出现错误，请确保视频文件存在且可访问');\n      return null;\n    } finally {\n      setIsVideoLoading(false);\n    }\n  };\n\n  // 选择开始句子\n  const selectStartSentence = (prompt) => {\n    setSelectedOption(prompt);\n    setIsConfirmMode(true);\n    generateVideoClip(prompt);\n  };\n\n  // 确认选择开始句子\n  const confirmStartSentence = () => {\n    const sentence = selectedOption;\n    if (!sentence) return;\n    \n    setCurrentSentence(sentence);\n    setGameLog([{...sentence, step: 1, clipUrl: videoUrl}]);\n    setClipUrls([...clipUrls, videoUrl]);\n    setGameStarted(true);\n    fetchNextOptions(sentence.text);\n    setIsConfirmMode(false);\n    setSelectedOption(null);\n  };\n\n  // 取消选择\n  const cancelSelection = () => {\n    setIsConfirmMode(false);\n    setSelectedOption(null);\n    setVideoUrl('');\n  };\n  \n  // 选择下一个句子\n  const selectNextSentence = (option) => {\n    setSelectedOption(option);\n    setIsConfirmMode(true);\n    generateVideoClip(option);\n  };\n\n  // 确认选择下一个句子\n  const confirmNextSentence = () => {\n    const sentence = selectedOption;\n    if (!sentence) return;\n    \n    setCurrentSentence(sentence);\n    setGameLog([...gameLog, {...sentence, step: gameLog.length + 1, clipUrl: videoUrl}]);\n    setClipUrls([...clipUrls, videoUrl]);\n    fetchNextOptions(sentence.text);\n    setIsConfirmMode(false);\n    setSelectedOption(null);\n  };\n\n  // 获取下一步选项\n  const fetchNextOptions = async (text) => {\n    if (!text) return;\n    \n    setLoadingNextOptions(true);\n    setGameError(null);\n    \n    try {\n      // 获取最后一个字，排除语气词\n      let lastChar = getLastValidChar(text);\n      \n      if (!lastChar) {\n        setGameError('无法识别有效的结尾字符');\n        setLoadingNextOptions(false);\n        return;\n      }\n      \n      console.log(`正在查找以\"${lastChar}\"开头的句子...`);\n      \n      const response = await fetch(`${API_BASE_URL}/api/search?query=${encodeURIComponent(`^${lastChar}`)}&use_regex=true`);\n      \n      if (!response.ok) {\n        throw new Error(`API请求失败: ${response.status}`);\n      }\n      \n      const data = await response.json();\n      \n      if (data && data.results) {\n        console.log(`API返回了 ${data.results.length} 条结果`);\n        \n        // 过滤结果，保留3-8个字的句子\n        const filteredResults = data.results.filter(item => {\n          const cleanText = item.text.replace(/[啊呢吗吧呀嘛哦哎嗯呐呵呦诶哈哟]$/, '');\n          return cleanText.length >= 3 && cleanText.length <= 8;\n        });\n        \n        console.log(`过滤后还有 ${filteredResults.length} 条结果`);\n        \n        if (filteredResults.length === 0) {\n          // 如果没有找到结果，尝试不使用正则表达式的精确查询\n          console.log(`尝试使用精确查询搜索以\"${lastChar}\"开头的句子`);\n          const fallbackResponse = await fetch(`${API_BASE_URL}/api/search?query=${encodeURIComponent(lastChar)}`);\n          const fallbackData = await fallbackResponse.json();\n          \n          if (fallbackData && fallbackData.results) {\n            console.log(`精确查询返回了 ${fallbackData.results.length} 条结果`);\n            // 手动过滤以lastChar开头的结果\n            const manualFilteredResults = fallbackData.results.filter(item => {\n              return item.text.startsWith(lastChar) && \n                     item.text.length >= 3 && \n                     item.text.length <= 8;\n            });\n            \n            if (manualFilteredResults.length > 0) {\n              console.log(`手动过滤后找到 ${manualFilteredResults.length} 条结果`);\n              // 随机选择最多8个结果\n              const shuffled = [...manualFilteredResults].sort(() => 0.5 - Math.random());\n              setNextOptions(shuffled.slice(0, 8));\n              setLoadingNextOptions(false);\n              return;\n            }\n          }\n          \n          setGameError(`没有找到以\"${lastChar}\"开头的句子`);\n        } else {\n          // 随机选择最多8个结果\n          const shuffled = [...filteredResults].sort(() => 0.5 - Math.random());\n          setNextOptions(shuffled.slice(0, 8));\n        }\n      } else {\n        setGameError('获取接续句子失败');\n      }\n    } catch (error) {\n      console.error('获取接续句子错误:', error);\n      setGameError(`查询错误: ${error.message}`);\n    } finally {\n      setLoadingNextOptions(false);\n    }\n  };\n\n  // 获取最后一个有效字符（排除语气词）\n  const getLastValidChar = (text) => {\n    if (!text || text.length === 0) return null;\n    \n    // 排除常见语气词\n    const cleanText = text.replace(/[啊呢吗吧呀嘛哦哎嗯呐呵呦诶哈哟]$/, '');\n    return cleanText.length > 0 ? cleanText[cleanText.length - 1] : null;\n  };\n\n  // 刷新下一步选项\n  const refreshNextOptions = () => {\n    if (currentSentence && !loadingNextOptions) {\n      fetchNextOptions(currentSentence.text);\n    }\n  };\n\n  // 回到上一步\n  const goBackOneStep = () => {\n    if (gameLog.length <= 1) {\n      // 只有一步，回到选择开始句子\n      setGameStarted(false);\n      setGameLog([]);\n      setCurrentSentence(null);\n      setNextOptions([]);\n      setClipUrls([]);\n      return;\n    }\n    \n    // 删除最后一步\n    const newLog = gameLog.slice(0, -1);\n    const newClipUrls = clipUrls.slice(0, -1);\n    setGameLog(newLog);\n    setClipUrls(newClipUrls);\n    setCurrentSentence(newLog[newLog.length - 1]);\n    fetchNextOptions(newLog[newLog.length - 1].text);\n  };\n\n  // 导出合并视频\n  const exportMergedVideo = async () => {\n    // 只从gameLog中获取选中的视频URL，而不是使用clipUrls\n    const selectedClipUrls = gameLog.map(entry => entry.clipUrl).filter(url => url);\n    \n    if (selectedClipUrls.length === 0) {\n      setGameError('没有可导出的视频');\n      return;\n    }\n    \n    setIsExportingVideo(true);\n    setGameError(null);\n    \n    try {\n      const response = await axios.post(`${API_BASE_URL}/api/merge_clips`, {\n        clip_urls: selectedClipUrls\n      });\n      \n      if (response.data.success) {\n        // 触发下载\n        const a = document.createElement('a');\n        // 注意这里使用video_url字段\n        a.href = `${API_BASE_URL}${response.data.video_url || response.data.merged_video_url}`;\n        a.download = '甄嬛传接龙.mp4';\n        document.body.appendChild(a);\n        a.click();\n        document.body.removeChild(a);\n      } else {\n        setGameError('导出视频失败');\n      }\n    } catch (error) {\n      console.error('导出视频错误:', error);\n      setGameError('导出视频失败，请确保服务器正常运行');\n    } finally {\n      setIsExportingVideo(false);\n    }\n  };\n\n  // 开始新游戏\n  const startNewGame = () => {\n    setGameLog([]);\n    fetchRandomPrompts();\n    setGameStarted(false);\n    setCurrentSentence(null);\n    setNextOptions([]);\n    setClipUrls([]);\n    setVideoUrl('');\n    setSelectedOption(null);\n    setIsConfirmMode(false);\n  };\n\n  // 初始加载时获取随机提示\n  useEffect(() => {\n    if (apiStatus === 'connected') {\n      fetchRandomPrompts();\n    }\n  }, [apiStatus]);\n\n  return (\n    <div className=\"chain-game-container\">\n      <div className=\"game-controls\">\n        <button \n          onClick={startNewGame}\n          className=\"new-game-btn\"\n          disabled={apiStatus !== 'connected'}\n        >\n          新游戏\n        </button>\n        {gameStarted && (\n          <button \n            onClick={goBackOneStep}\n            className=\"back-btn\"\n            disabled={gameLog.length === 0}\n          >\n            上一步\n          </button>\n        )}\n        {clipUrls.length > 1 && (\n          <button\n            onClick={exportMergedVideo}\n            className=\"export-btn\"\n            disabled={isExportingVideo}\n          >\n            {isExportingVideo ? '导出中...' : '导出接龙视频'}\n          </button>\n        )}\n      </div>\n      \n      {gameError && <div className=\"error-message\">{gameError}</div>}\n      \n      <div className=\"game-content\">\n        {/* 左侧：候选词区域 */}\n        <div className=\"game-candidates\">\n          {!gameStarted ? (\n            <div className=\"start-game-section\">\n              <div className=\"section-header\">\n                <h2>选择开始句子</h2>\n                <button \n                  onClick={refreshRandomPrompts}\n                  className=\"refresh-btn\"\n                  disabled={loadingPrompts || apiStatus !== 'connected'}\n                >\n                  换一批\n                </button>\n              </div>\n              \n              {loadingPrompts ? (\n                <div className=\"loading\">加载提示句子中...</div>\n              ) : (\n                <ul className=\"prompts-list\">\n                  {currentPrompts.map((prompt, index) => (\n                    <li \n                      key={index} \n                      onClick={() => selectStartSentence(prompt)}\n                      className={selectedOption === prompt ? 'prompt-item selected' : 'prompt-item'}\n                    >\n                      <div className=\"prompt-text\">{prompt.text}</div>\n                      <div className=\"prompt-info\">\n                        <span className=\"episode\">{formatEpisode(prompt.episode)}</span>\n                        <span className=\"time\">{formatTime(prompt.start_seconds)}</span>\n                        <span className={`sentence-type ${analyzeSentenceType(prompt.text)}`}>{analyzeSentenceType(prompt.text)}</span>\n                      </div>\n                    </li>\n                  ))}\n                </ul>\n              )}\n              {currentPrompts.length === 0 && !loadingPrompts && (\n                <div className=\"no-prompts\">\n                  <p>没有可用的提示句子</p>\n                  <button \n                    onClick={fetchRandomPrompts}\n                    disabled={apiStatus !== 'connected'}\n                  >\n                    重新获取\n                  </button>\n                </div>\n              )}\n            </div>\n          ) : (\n            <>\n              <div className=\"current-section\">\n                <h2>当前句子</h2>\n                <div className=\"current-sentence\">\n                  <div className=\"current-text\">{currentSentence?.text}</div>\n                  <div className=\"current-info\">\n                    <span className=\"episode\">{formatEpisode(currentSentence?.episode)}</span>\n                    <span className=\"time\">{formatTime(currentSentence?.start_seconds)}</span>\n                  </div>\n                  <div className=\"next-hint\">\n                    下一句需以「{getLastValidChar(currentSentence?.text)}」字开头\n                  </div>\n                </div>\n              </div>\n                \n              <div className=\"next-options-section\">\n                <div className=\"section-header\">\n                  <h2>可选接续</h2>\n                  <button \n                    onClick={refreshNextOptions}\n                    className=\"refresh-btn\"\n                    disabled={loadingNextOptions}\n                  >\n                    换一批\n                  </button>\n                </div>\n                \n                {loadingNextOptions ? (\n                  <div className=\"loading\">加载接续句子中...</div>\n                ) : (\n                  <ul className=\"options-list\">\n                    {nextOptions.map((option, index) => (\n                      <li \n                        key={index}\n                        onClick={() => selectNextSentence(option)}\n                        className={selectedOption === option ? 'option-item selected' : 'option-item'}\n                      >\n                        <div className=\"option-text\">{option.text}</div>\n                        <div className=\"option-info\">\n                          <span className=\"episode\">{formatEpisode(option.episode)}</span>\n                          <span className=\"time\">{formatTime(option.start_seconds)}</span>\n                          <span className={`sentence-type ${analyzeSentenceType(option.text)}`}>{analyzeSentenceType(option.text)}</span>\n                        </div>\n                      </li>\n                    ))}\n                  </ul>\n                )}\n                {nextOptions.length === 0 && !loadingNextOptions && (\n                  <div className=\"no-options\">\n                    <p>没有找到合适的接续句子</p>\n                    <button onClick={startNewGame}>重新开始</button>\n                  </div>\n                )}\n              </div>\n            </>\n          )}\n\n          {/* 接龙记录 */}\n          <div className=\"game-log-section\">\n            <h2>接龙记录</h2>\n            {gameLog.length > 0 ? (\n              <ol className=\"game-log-list\">\n                {gameLog.map((log, index) => (\n                  <li key={index} className=\"log-item\">\n                    <div className=\"log-text\">{log.text}</div>\n                    <div className=\"log-info\">\n                      <span className=\"episode\">{formatEpisode(log.episode)}</span>\n                      <span className=\"time\">{formatTime(log.start_seconds)}</span>\n                      {log.clipUrl && (\n                        <span className=\"clip-info\">\n                          <i className=\"video-icon\">🎬</i>\n                        </span>\n                      )}\n                    </div>\n                  </li>\n                ))}\n              </ol>\n            ) : (\n              <div className=\"empty-log\">尚未开始游戏</div>\n            )}\n          </div>\n        </div>\n\n        {/* 右侧：视频预览区域 */}\n        <div className=\"game-video-preview\">\n          {isConfirmMode && (\n            <div className=\"confirm-section\">\n              <div className=\"selected-sentence\">\n                <div className=\"selected-text\">{selectedOption?.text}</div>\n                <div className=\"selected-info\">\n                  <span className=\"episode\">{formatEpisode(selectedOption?.episode)}</span>\n                  <span className=\"time\">{formatTime(selectedOption?.start_seconds)}</span>\n                </div>\n              </div>\n              \n              <div className=\"video-preview\">\n                {isVideoLoading ? (\n                  <div className=\"loading-video\">生成视频片段中，请稍候...</div>\n                ) : videoUrl ? (\n                  <video \n                    controls \n                    autoPlay \n                    className=\"video-element\"\n                    src={videoUrl}\n                  />\n                ) : (\n                  <div className=\"video-placeholder\">准备生成视频片段...</div>\n                )}\n              </div>\n              \n              <div className=\"confirm-buttons\">\n                <button \n                  className=\"confirm-btn\"\n                  onClick={gameStarted ? confirmNextSentence : confirmStartSentence}\n                  disabled={isVideoLoading || !videoUrl}\n                >\n                  确认选择\n                </button>\n                <button \n                  className=\"cancel-btn\"\n                  onClick={cancelSelection}\n                >\n                  取消选择\n                </button>\n              </div>\n            </div>\n          )}\n          {!isConfirmMode && (\n            <div className=\"video-section\">\n              <h2>视频预览</h2>\n              {isVideoLoading ? (\n                <div className=\"loading-video\">生成视频片段中，请稍候...</div>\n              ) : videoUrl ? (\n                <video \n                  controls \n                  autoPlay \n                  className=\"video-element\"\n                  src={videoUrl}\n                />\n              ) : (\n                <div className=\"video-placeholder large\">\n                  <div className=\"placeholder-text\">\n                    <p>请从左侧选择一个句子</p>\n                    <p>选择后将在此处预览视频</p>\n                  </div>\n                </div>\n              )}\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\n// 押韵游戏组件\nconst RhymeGamePage = ({ \n  API_BASE_URL, \n  apiStatus,\n  formatTime,\n  formatEpisode\n}) => {\n  const [gameStarted, setGameStarted] = useState(false);\n  const [currentPrompts, setCurrentPrompts] = useState([]);\n  const [loadingPrompts, setLoadingPrompts] = useState(false);\n  const [gameLog, setGameLog] = useState([]);\n  const [currentSentence, setCurrentSentence] = useState(null);\n  const [nextOptions, setNextOptions] = useState([]);\n  const [loadingNextOptions, setLoadingNextOptions] = useState(false);\n  const [gameError, setGameError] = useState(null);\n  const [videoUrl, setVideoUrl] = useState('');\n  const [isVideoLoading, setIsVideoLoading] = useState(false);\n  const [selectedOption, setSelectedOption] = useState(null);\n  const [isExportingVideo, setIsExportingVideo] = useState(false);\n  const [clipUrls, setClipUrls] = useState([]);\n  const [isConfirmMode, setIsConfirmMode] = useState(false);\n\n  // 获取随机提示句子\n  const fetchRandomPrompts = async () => {\n    setLoadingPrompts(true);\n    setGameError(null);\n    \n    try {\n      const response = await axios.get(`${API_BASE_URL}/api/random_sentences`, {\n        params: { count: 8 }\n      });\n      \n      if (response.data && response.data.sentences) {\n        setCurrentPrompts(response.data.sentences);\n      } else {\n        setGameError('获取提示句子失败');\n      }\n    } catch (error) {\n      console.error('获取提示句子错误:', error);\n      setGameError('无法获取提示句子，请确保API服务正常运行');\n    } finally {\n      setLoadingPrompts(false);\n    }\n  };\n\n  // 刷新随机提示\n  const refreshRandomPrompts = () => {\n    if (apiStatus === 'connected' && !loadingPrompts) {\n      fetchRandomPrompts();\n    }\n  };\n\n  // 生成视频片段\n  const generateVideoClip = async (subtitle) => {\n    setIsVideoLoading(true);\n    setVideoUrl('');\n    setGameError(null);\n    \n    try {\n      const response = await axios.post(`${API_BASE_URL}/api/generate_clip`, {\n        episode: subtitle.episode,\n        start_time: subtitle.start_seconds,\n        end_time: subtitle.end_seconds,\n        context_seconds: 2\n      });\n\n      if (response.data.success) {\n        const clipUrl = `${API_BASE_URL}${response.data.video_url}`;\n        setVideoUrl(clipUrl);\n        return clipUrl;\n      } else {\n        setGameError('生成视频片段失败');\n        return null;\n      }\n    } catch (error) {\n      console.error('生成视频片段出错:', error);\n      setGameError('视频服务出现错误，请确保视频文件存在且可访问');\n      return null;\n    } finally {\n      setIsVideoLoading(false);\n    }\n  };\n\n  // 选择开始句子\n  const selectStartSentence = (prompt) => {\n    setSelectedOption(prompt);\n    setIsConfirmMode(true);\n    generateVideoClip(prompt);\n  };\n\n  // 确认选择开始句子\n  const confirmStartSentence = () => {\n    const sentence = selectedOption;\n    if (!sentence) return;\n    \n    setCurrentSentence(sentence);\n    setGameLog([{...sentence, step: 1, clipUrl: videoUrl}]);\n    setClipUrls([...clipUrls, videoUrl]);\n    setGameStarted(true);\n    fetchRhymingOptions(sentence.text);\n    setIsConfirmMode(false);\n    setSelectedOption(null);\n  };\n\n  // 取消选择\n  const cancelSelection = () => {\n    setIsConfirmMode(false);\n    setSelectedOption(null);\n    setVideoUrl('');\n  };\n  \n  // 选择下一个句子\n  const selectNextSentence = (option) => {\n    setSelectedOption(option);\n    setIsConfirmMode(true);\n    generateVideoClip(option);\n  };\n\n  // 确认选择下一个句子\n  const confirmNextSentence = () => {\n    const sentence = selectedOption;\n    if (!sentence) return;\n    \n    setCurrentSentence(sentence);\n    setGameLog([...gameLog, {...sentence, step: gameLog.length + 1, clipUrl: videoUrl}]);\n    setClipUrls([...clipUrls, videoUrl]);\n    fetchRhymingOptions(sentence.text);\n    setIsConfirmMode(false);\n    setSelectedOption(null);\n  };\n\n  // 获取押韵选项\n  const fetchRhymingOptions = async (text) => {\n    if (!text) return;\n    \n    setLoadingNextOptions(true);\n    setGameError(null);\n    \n    try {\n      // 获取最后一个字的拼音，用于押韵\n      const lastChar = getLastValidChar(text);\n      \n      if (!lastChar) {\n        setGameError('无法识别有效的结尾字符');\n        setLoadingNextOptions(false);\n        return;\n      }\n      \n      console.log(`正在查找与\"${lastChar}\"押韵的句子...`);\n      \n      // 调用押韵API\n      const response = await axios.get(`${API_BASE_URL}/api/rhyming_sentences`, {\n        params: {\n          text: text,\n          min_length: 3,\n          max_length: 8,\n          limit: 8\n        }\n      });\n      \n      if (response.data && response.data.sentences) {\n        console.log(`API返回了 ${response.data.sentences.length} 条押韵结果`);\n        setNextOptions(response.data.sentences);\n      } else {\n        setGameError('获取押韵句子失败：无结果返回');\n        setNextOptions([]);\n      }\n    } catch (error) {\n      console.error('获取押韵句子错误:', error);\n      setGameError(`查询错误: ${error.message}`);\n      setNextOptions([]);\n    } finally {\n      setLoadingNextOptions(false);\n    }\n  };\n\n  // 获取最后一个有效字符（排除语气词）\n  const getLastValidChar = (text) => {\n    if (!text || text.length === 0) return null;\n    \n    // 排除常见语气词\n    const cleanText = text.replace(/[啊呢吗吧呀嘛哦哎嗯呐呵呦诶哈哟]$/, '');\n    return cleanText.length > 0 ? cleanText[cleanText.length - 1] : null;\n  };\n\n  // 刷新下一步选项\n  const refreshNextOptions = () => {\n    if (currentSentence && !loadingNextOptions) {\n      fetchRhymingOptions(currentSentence.text);\n    }\n  };\n\n  // 回到上一步\n  const goBackOneStep = () => {\n    if (gameLog.length <= 1) {\n      // 只有一步，回到选择开始句子\n      setGameStarted(false);\n      setGameLog([]);\n      setCurrentSentence(null);\n      setNextOptions([]);\n      setClipUrls([]);\n      setVideoUrl('');\n      fetchRandomPrompts();\n    } else {\n      // 移除最后一步\n      const newLog = [...gameLog];\n      newLog.pop();\n      setGameLog(newLog);\n      \n      // 更新当前句子和视频\n      const prevSentence = newLog[newLog.length - 1];\n      setCurrentSentence(prevSentence);\n      \n      // 更新剪辑URL列表\n      const newClipUrls = [...clipUrls];\n      newClipUrls.pop();\n      setClipUrls(newClipUrls);\n      \n      // 重新获取选项\n      fetchRhymingOptions(prevSentence.text);\n    }\n  };\n\n  // 合并视频并导出\n  const exportMergedVideo = async () => {\n    if (clipUrls.length === 0) return;\n    \n    setIsExportingVideo(true);\n    setGameError(null);\n    \n    try {\n      const response = await axios.post(`${API_BASE_URL}/api/merge_clips`, {\n        clip_urls: clipUrls\n      });\n      \n      if (response.data.success) {\n        const mergedVideoUrl = `${API_BASE_URL}${response.data.video_url || response.data.merged_video_url}`;\n        \n        // 创建下载链接\n        const link = document.createElement('a');\n        link.href = mergedVideoUrl;\n        link.download = '押韵视频.mp4';\n        link.click();\n        \n        console.log('视频合并成功，已触发下载');\n      } else {\n        setGameError('视频合并失败: ' + (response.data.error || '未知错误'));\n      }\n    } catch (error) {\n      console.error('视频合并错误:', error);\n      setGameError('视频合并服务出错: ' + error.message);\n    } finally {\n      setIsExportingVideo(false);\n    }\n  };\n\n  // 开始新游戏\n  const startNewGame = () => {\n    setGameLog([]);\n    fetchRandomPrompts();\n    setGameStarted(false);\n    setCurrentSentence(null);\n    setNextOptions([]);\n    setClipUrls([]);\n    setVideoUrl('');\n    setSelectedOption(null);\n    setIsConfirmMode(false);\n  };\n\n  // 初始加载时获取随机提示\n  useEffect(() => {\n    if (apiStatus === 'connected') {\n      fetchRandomPrompts();\n    }\n  }, [apiStatus]);\n\n  return (\n    <div className=\"chain-game-container\">\n      <div className=\"game-controls\">\n        <button \n          onClick={startNewGame}\n          className=\"new-game-btn\"\n          disabled={apiStatus !== 'connected'}\n        >\n          新游戏\n        </button>\n        \n        {gameLog.length > 0 && (\n          <>\n            <button \n              onClick={goBackOneStep}\n              className=\"back-btn\"\n              disabled={isConfirmMode}\n            >\n              上一步\n            </button>\n            \n            <button \n              onClick={exportMergedVideo}\n              className=\"export-btn\"\n              disabled={gameLog.length < 2 || isExportingVideo}\n            >\n              {isExportingVideo ? '导出中...' : '导出押韵视频'}\n            </button>\n          </>\n        )}\n      </div>\n      \n      {gameError && (\n        <div className=\"game-error\">{gameError}</div>\n      )}\n      \n      <div className=\"game-content\">\n        {/* 左侧：候选词区域 */}\n        <div className=\"game-candidates\">\n          {!gameStarted ? (\n            <div className=\"start-game-section\">\n              <div className=\"section-header\">\n                <h2>选择开始句子</h2>\n                <button \n                  onClick={refreshRandomPrompts}\n                  className=\"refresh-btn\"\n                  disabled={loadingPrompts || apiStatus !== 'connected'}\n                >\n                  换一批\n                </button>\n              </div>\n              \n              {loadingPrompts ? (\n                <div className=\"loading\">加载提示句子中...</div>\n              ) : (\n                <ul className=\"prompts-list\">\n                  {currentPrompts.map((prompt, index) => (\n                    <li \n                      key={index} \n                      onClick={() => selectStartSentence(prompt)}\n                      className={selectedOption === prompt ? 'prompt-item selected' : 'prompt-item'}\n                    >\n                      <div className=\"prompt-text\">{prompt.text}</div>\n                      <div className=\"prompt-info\">\n                        <span className=\"episode\">{formatEpisode(prompt.episode)}</span>\n                        <span className=\"time\">{formatTime(prompt.start_seconds)}</span>\n                        <span className={`sentence-type ${analyzeSentenceType(prompt.text)}`}>{analyzeSentenceType(prompt.text)}</span>\n                      </div>\n                    </li>\n                  ))}\n                </ul>\n              )}\n              \n              {currentPrompts.length === 0 && !loadingPrompts && (\n                <div className=\"empty-prompts\">\n                  <p>没有可用的提示句子</p>\n                  <button onClick={refreshRandomPrompts}>重新获取</button>\n                </div>\n              )}\n            </div>\n          ) : (\n            <>\n              <div className=\"current-sentence-section\">\n                <div className=\"section-header\">\n                  <h2>当前句子</h2>\n                </div>\n                \n                <div className=\"current-sentence\">\n                  <div className=\"sentence-text\">{currentSentence?.text}</div>\n                  <div className=\"sentence-info\">\n                    <span className=\"episode\">{formatEpisode(currentSentence?.episode)}</span>\n                    <span className=\"time\">{formatTime(currentSentence?.start_seconds)}</span>\n                  </div>\n                  <div className=\"sentence-type-tag\">\n                    <span className={analyzeSentenceType(currentSentence?.text)}>{analyzeSentenceType(currentSentence?.text)}</span>\n                  </div>\n                </div>\n              </div>\n              \n              <div className=\"next-options-section\">\n                <div className=\"section-header\">\n                  <h2>押韵选项</h2>\n                  <button \n                    onClick={refreshNextOptions}\n                    className=\"refresh-btn\"\n                    disabled={loadingNextOptions}\n                  >\n                    换一批\n                  </button>\n                </div>\n                \n                {loadingNextOptions ? (\n                  <div className=\"loading\">加载押韵句子中...</div>\n                ) : (\n                  <ul className=\"options-list\">\n                    {nextOptions.map((option, index) => (\n                      <li \n                        key={index}\n                        onClick={() => selectNextSentence(option)}\n                        className={selectedOption === option ? 'option-item selected' : 'option-item'}\n                      >\n                        <div className=\"option-text\">{option.text}</div>\n                        <div className=\"option-info\">\n                          <span className=\"episode\">{formatEpisode(option.episode)}</span>\n                          <span className=\"time\">{formatTime(option.start_seconds)}</span>\n                          <span className={`sentence-type ${analyzeSentenceType(option.text)}`}>{analyzeSentenceType(option.text)}</span>\n                        </div>\n                      </li>\n                    ))}\n                  </ul>\n                )}\n                \n                {nextOptions.length === 0 && !loadingNextOptions && (\n                  <div className=\"empty-options\">\n                    <p>没有找到合适的押韵句子</p>\n                    <button onClick={startNewGame}>重新开始</button>\n                  </div>\n                )}\n              </div>\n            </>\n          )}\n\n          {/* 接龙记录 */}\n          <div className=\"game-log-section\">\n            <h2>押韵记录</h2>\n            {gameLog.length > 0 ? (\n              <ol className=\"game-log-list\">\n                {gameLog.map((log, index) => (\n                  <li key={index} className=\"log-item\">\n                    <div className=\"log-text\">{log.text}</div>\n                    <div className=\"log-info\">\n                      <span className=\"episode\">{formatEpisode(log.episode)}</span>\n                      <span className=\"time\">{formatTime(log.start_seconds)}</span>\n                      {log.clipUrl && (\n                        <span className=\"clip-info\">\n                          <i className=\"video-icon\">🎬</i>\n                        </span>\n                      )}\n                    </div>\n                  </li>\n                ))}\n              </ol>\n            ) : (\n              <div className=\"empty-log\">尚未开始游戏</div>\n            )}\n          </div>\n        </div>\n\n        {/* 右侧：视频预览区域 */}\n        <div className=\"game-video-preview\">\n          {isConfirmMode && (\n            <div className=\"confirm-section\">\n              <div className=\"selected-sentence\">\n                <div className=\"selected-text\">{selectedOption?.text}</div>\n                <div className=\"selected-info\">\n                  <span className=\"episode\">{formatEpisode(selectedOption?.episode)}</span>\n                  <span className=\"time\">{formatTime(selectedOption?.start_seconds)}</span>\n                </div>\n              </div>\n              \n              <div className=\"video-preview\">\n                {isVideoLoading ? (\n                  <div className=\"loading-video\">生成视频片段中，请稍候...</div>\n                ) : videoUrl ? (\n                  <video \n                    controls \n                    autoPlay \n                    className=\"video-element\"\n                    src={videoUrl}\n                  />\n                ) : (\n                  <div className=\"video-placeholder\">准备生成视频片段...</div>\n                )}\n              </div>\n              \n              <div className=\"confirm-buttons\">\n                <button \n                  className=\"confirm-btn\"\n                  onClick={gameStarted ? confirmNextSentence : confirmStartSentence}\n                  disabled={isVideoLoading || !videoUrl}\n                >\n                  确认选择\n                </button>\n                <button \n                  className=\"cancel-btn\"\n                  onClick={cancelSelection}\n                >\n                  取消选择\n                </button>\n              </div>\n            </div>\n          )}\n          {!isConfirmMode && (\n            <div className=\"video-section\">\n              <h2>视频预览</h2>\n              {isVideoLoading ? (\n                <div className=\"loading-video\">生成视频片段中，请稍候...</div>\n              ) : videoUrl ? (\n                <video \n                  controls \n                  autoPlay \n                  className=\"video-element\"\n                  src={videoUrl}\n                />\n              ) : (\n                <div className=\"video-placeholder large\">\n                  <div className=\"placeholder-text\">\n                    <p>请从左侧选择一个句子</p>\n                    <p>选择后将在此处预览视频</p>\n                  </div>\n                </div>\n              )}\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\n// 分析句子类型 - 全局辅助函数\nconst analyzeSentenceType = (text) => {\n  if (!text) return '普通句';\n  \n  // 判断是否为问句\n  if (text.includes('?') || text.includes('？') || text.includes('吗') || text.includes('呢')) {\n    return '疑问句';\n  }\n  \n  // 判断是否为命令句\n  const commandWords = ['去', '来', '给我', '快', '立刻', '马上', '传'];\n  if (commandWords.some(word => text.includes(word))) {\n    return '命令句';\n  }\n  \n  // 判断情感色彩\n  const positiveWords = ['好', '愿意', '可以', '是', '对', '喜欢', '爱', '高兴'];\n  const negativeWords = ['不', '没', '别', '莫', '拒绝', '难过', '恨', '讨厌'];\n  \n  if (positiveWords.some(word => text.includes(word))) {\n    return '积极句';\n  }\n  \n  if (negativeWords.some(word => text.includes(word))) {\n    return '消极句';\n  }\n  \n  return '普通句';\n};\n\n// 奇妙对话组件\nconst DialogueGamePage = ({ \n  API_BASE_URL, \n  apiStatus,\n  formatTime,\n  formatEpisode\n}) => {\n  const [gameStarted, setGameStarted] = useState(false);\n  const [currentPrompts, setCurrentPrompts] = useState([]);\n  const [loadingPrompts, setLoadingPrompts] = useState(false);\n  const [gameLog, setGameLog] = useState([]);\n  const [currentSentence, setCurrentSentence] = useState(null);\n  const [nextOptions, setNextOptions] = useState([]);\n  const [loadingNextOptions, setLoadingNextOptions] = useState(false);\n  const [gameError, setGameError] = useState(null);\n  const [videoUrl, setVideoUrl] = useState('');\n  const [isVideoLoading, setIsVideoLoading] = useState(false);\n  const [selectedOption, setSelectedOption] = useState(null);\n  const [isExportingVideo, setIsExportingVideo] = useState(false);\n  const [clipUrls, setClipUrls] = useState([]);\n  const [isConfirmMode, setIsConfirmMode] = useState(false);\n\n  // 获取随机提示句子\n  const fetchRandomPrompts = async () => {\n    setLoadingPrompts(true);\n    setGameError(null);\n    \n    try {\n      const response = await axios.get(`${API_BASE_URL}/api/random_sentences`, {\n        params: { count: 8 }\n      });\n      \n      if (response.data && response.data.sentences) {\n        setCurrentPrompts(response.data.sentences);\n      } else {\n        setGameError('获取提示句子失败');\n      }\n    } catch (error) {\n      console.error('获取提示句子错误:', error);\n      setGameError('无法获取提示句子，请确保API服务正常运行');\n    } finally {\n      setLoadingPrompts(false);\n    }\n  };\n\n  // 刷新随机提示\n  const refreshRandomPrompts = () => {\n    if (apiStatus === 'connected' && !loadingPrompts) {\n      fetchRandomPrompts();\n    }\n  };\n\n  // 生成视频片段\n  const generateVideoClip = async (subtitle) => {\n    setIsVideoLoading(true);\n    setVideoUrl('');\n    setGameError(null);\n    \n    try {\n      const response = await axios.post(`${API_BASE_URL}/api/generate_clip`, {\n        episode: subtitle.episode,\n        start_time: subtitle.start_seconds,\n        end_time: subtitle.end_seconds,\n        context_seconds: 2\n      });\n\n      if (response.data.success) {\n        const clipUrl = `${API_BASE_URL}${response.data.video_url}`;\n        setVideoUrl(clipUrl);\n        return clipUrl;\n      } else {\n        setGameError('生成视频片段失败');\n        return null;\n      }\n    } catch (error) {\n      console.error('生成视频片段出错:', error);\n      setGameError('视频服务出现错误，请确保视频文件存在且可访问');\n      return null;\n    } finally {\n      setIsVideoLoading(false);\n    }\n  };\n\n  // 选择开始句子\n  const selectStartSentence = (prompt) => {\n    setSelectedOption(prompt);\n    setIsConfirmMode(true);\n    generateVideoClip(prompt);\n  };\n\n  // 确认选择开始句子\n  const confirmStartSentence = () => {\n    const sentence = selectedOption;\n    if (!sentence) return;\n    \n    setCurrentSentence(sentence);\n    setGameLog([{...sentence, step: 1, clipUrl: videoUrl}]);\n    setClipUrls([...clipUrls, videoUrl]);\n    setGameStarted(true);\n    fetchDialogueResponses(sentence);\n    setIsConfirmMode(false);\n    setSelectedOption(null);\n  };\n\n  // 取消选择\n  const cancelSelection = () => {\n    setIsConfirmMode(false);\n    setSelectedOption(null);\n    setVideoUrl('');\n  };\n  \n  // 选择下一个句子\n  const selectNextSentence = (option) => {\n    setSelectedOption(option);\n    setIsConfirmMode(true);\n    generateVideoClip(option);\n  };\n\n  // 确认选择下一个句子\n  const confirmNextSentence = () => {\n    const sentence = selectedOption;\n    if (!sentence) return;\n    \n    setCurrentSentence(sentence);\n    setGameLog([...gameLog, {...sentence, step: gameLog.length + 1, clipUrl: videoUrl}]);\n    setClipUrls([...clipUrls, videoUrl]);\n    fetchDialogueResponses(sentence);\n    setIsConfirmMode(false);\n    setSelectedOption(null);\n  };\n\n  // 获取对话回应选项\n  const fetchDialogueResponses = async (sentence) => {\n    if (!sentence) return;\n    \n    setLoadingNextOptions(true);\n    setGameError(null);\n    \n    try {\n      console.log(`正在查找对\"${sentence.text}\"的有趣回应...`);\n      \n      // 调用后端API查询对话回应\n      const response = await axios.post(`${API_BASE_URL}/api/dialogue_responses`, {\n        sentence_id: sentence.id,\n        sentence_text: sentence.text,\n        episode: sentence.episode\n      });\n      \n      if (response.data && response.data.results) {\n        console.log(`API返回了 ${response.data.results.length} 条对话回应`);\n        setNextOptions(response.data.results);\n      } else {\n        setGameError('获取对话回应失败：无结果返回');\n        setNextOptions([]);\n      }\n    } catch (error) {\n      console.error('获取对话回应错误:', error);\n      setGameError(`获取对话回应失败: ${error.message}`);\n      setNextOptions([]);\n    } finally {\n      setLoadingNextOptions(false);\n    }\n  };\n\n  // 刷新下一步选项\n  const refreshNextOptions = () => {\n    if (currentSentence && !loadingNextOptions) {\n      fetchDialogueResponses(currentSentence);\n    }\n  };\n\n  // 回到上一步\n  const goBackOneStep = () => {\n    if (gameLog.length <= 1) {\n      // 只有一步，回到选择开始句子\n      setGameStarted(false);\n      setGameLog([]);\n      setCurrentSentence(null);\n      setNextOptions([]);\n      setClipUrls([]);\n      setVideoUrl('');\n      fetchRandomPrompts();\n    } else {\n      // 移除最后一步\n      const newLog = [...gameLog];\n      newLog.pop();\n      setGameLog(newLog);\n      \n      // 更新当前句子和视频\n      const prevSentence = newLog[newLog.length - 1];\n      setCurrentSentence(prevSentence);\n      \n      // 更新剪辑URL列表\n      const newClipUrls = [...clipUrls];\n      newClipUrls.pop();\n      setClipUrls(newClipUrls);\n      \n      // 重新获取选项\n      fetchDialogueResponses(prevSentence);\n    }\n  };\n\n  // 合并视频并导出\n  const exportMergedVideo = async () => {\n    if (clipUrls.length === 0) return;\n    \n    setIsExportingVideo(true);\n    setGameError(null);\n    \n    try {\n      const response = await axios.post(`${API_BASE_URL}/api/merge_clips`, {\n        clip_urls: clipUrls\n      });\n      \n      if (response.data.success) {\n        const mergedVideoUrl = `${API_BASE_URL}${response.data.video_url || response.data.merged_video_url}`;\n        \n        // 创建下载链接\n        const link = document.createElement('a');\n        link.href = mergedVideoUrl;\n        link.download = '奇妙对话视频.mp4';\n        link.click();\n        \n        console.log('视频合并成功，已触发下载');\n      } else {\n        setGameError('视频合并失败: ' + (response.data.error || '未知错误'));\n      }\n    } catch (error) {\n      console.error('视频合并错误:', error);\n      setGameError('视频合并服务出错: ' + error.message);\n    } finally {\n      setIsExportingVideo(false);\n    }\n  };\n\n  // 开始新游戏\n  const startNewGame = () => {\n    setGameLog([]);\n    fetchRandomPrompts();\n    setGameStarted(false);\n    setCurrentSentence(null);\n    setNextOptions([]);\n    setClipUrls([]);\n    setVideoUrl('');\n    setSelectedOption(null);\n    setIsConfirmMode(false);\n  };\n\n  // 初始加载时获取随机提示\n  useEffect(() => {\n    if (apiStatus === 'connected') {\n      fetchRandomPrompts();\n    }\n  }, [apiStatus]);\n\n  return (\n    <div className=\"chain-game-container\">\n      <div className=\"game-controls\">\n        <button \n          onClick={startNewGame}\n          className=\"new-game-btn\"\n          disabled={apiStatus !== 'connected'}\n        >\n          新游戏\n        </button>\n        \n        {gameLog.length > 0 && (\n          <>\n            <button \n              onClick={goBackOneStep}\n              className=\"back-btn\"\n              disabled={isConfirmMode}\n            >\n              上一步\n            </button>\n            \n            <button \n              onClick={exportMergedVideo}\n              className=\"export-btn\"\n              disabled={gameLog.length < 2 || isExportingVideo}\n            >\n              {isExportingVideo ? '导出中...' : '导出对话视频'}\n            </button>\n          </>\n        )}\n      </div>\n      \n      {gameError && (\n        <div className=\"game-error\">{gameError}</div>\n      )}\n      \n      <div className=\"game-content\">\n        {/* 左侧：候选词区域 */}\n        <div className=\"game-candidates\">\n          {!gameStarted ? (\n            <div className=\"start-game-section\">\n              <div className=\"section-header\">\n                <h2>选择开始句子</h2>\n                <button \n                  onClick={refreshRandomPrompts}\n                  className=\"refresh-btn\"\n                  disabled={loadingPrompts || apiStatus !== 'connected'}\n                >\n                  换一批\n                </button>\n              </div>\n              \n              {loadingPrompts ? (\n                <div className=\"loading\">加载提示句子中...</div>\n              ) : (\n                <ul className=\"prompts-list\">\n                  {currentPrompts.map((prompt, index) => (\n                    <li \n                      key={index} \n                      onClick={() => selectStartSentence(prompt)}\n                      className={selectedOption === prompt ? 'prompt-item selected' : 'prompt-item'}\n                    >\n                      <div className=\"prompt-text\">{prompt.text}</div>\n                      <div className=\"prompt-info\">\n                        <span className=\"episode\">{formatEpisode(prompt.episode)}</span>\n                        <span className=\"time\">{formatTime(prompt.start_seconds)}</span>\n                        <span className={`sentence-type ${analyzeSentenceType(prompt.text)}`}>{analyzeSentenceType(prompt.text)}</span>\n                      </div>\n                    </li>\n                  ))}\n                </ul>\n              )}\n              \n              {currentPrompts.length === 0 && !loadingPrompts && (\n                <div className=\"empty-prompts\">\n                  <p>没有可用的提示句子</p>\n                  <button onClick={refreshRandomPrompts}>重新获取</button>\n                </div>\n              )}\n            </div>\n          ) : (\n            <>\n              <div className=\"current-sentence-section\">\n                <div className=\"section-header\">\n                  <h2>当前句子</h2>\n                </div>\n                \n                <div className=\"current-sentence\">\n                  <div className=\"sentence-text\">{currentSentence?.text}</div>\n                  <div className=\"sentence-info\">\n                    <span className=\"episode\">{formatEpisode(currentSentence?.episode)}</span>\n                    <span className=\"time\">{formatTime(currentSentence?.start_seconds)}</span>\n                  </div>\n                  <div className=\"sentence-type-tag\">\n                    <span className={analyzeSentenceType(currentSentence?.text)}>{analyzeSentenceType(currentSentence?.text)}</span>\n                  </div>\n                </div>\n              </div>\n              \n              <div className=\"next-options-section\">\n                <div className=\"section-header\">\n                  <h2>有趣回应</h2>\n                  <button \n                    onClick={refreshNextOptions}\n                    className=\"refresh-btn\"\n                    disabled={loadingNextOptions}\n                  >\n                    换一批\n                  </button>\n                </div>\n                \n                {loadingNextOptions ? (\n                  <div className=\"loading\">查找有趣回应中...</div>\n                ) : (\n                  <ul className=\"options-list\">\n                    {nextOptions.map((option, index) => (\n                      <li \n                        key={index}\n                        onClick={() => selectNextSentence(option)}\n                        className={selectedOption === option ? 'option-item selected' : 'option-item'}\n                      >\n                        <div className=\"option-text\">{option.text}</div>\n                        <div className=\"option-info\">\n                          <span className=\"episode\">{formatEpisode(option.episode)}</span>\n                          <span className=\"time\">{formatTime(option.start_seconds)}</span>\n                          <span className={`sentence-type ${analyzeSentenceType(option.text)}`}>{analyzeSentenceType(option.text)}</span>\n                        </div>\n                      </li>\n                    ))}\n                  </ul>\n                )}\n                \n                {nextOptions.length === 0 && !loadingNextOptions && (\n                  <div className=\"empty-options\">\n                    <p>没有找到合适的回应句子</p>\n                    <button onClick={startNewGame}>重新开始</button>\n                  </div>\n                )}\n              </div>\n            </>\n          )}\n\n          {/* 对话记录 */}\n          <div className=\"game-log-section\">\n            <h2>对话记录</h2>\n            {gameLog.length > 0 ? (\n              <ol className=\"game-log-list\">\n                {gameLog.map((log, index) => (\n                  <li key={index} className=\"log-item\">\n                    <div className=\"log-text\">{log.text}</div>\n                    <div className=\"log-info\">\n                      <span className=\"episode\">{formatEpisode(log.episode)}</span>\n                      <span className=\"time\">{formatTime(log.start_seconds)}</span>\n                      {log.clipUrl && (\n                        <span className=\"clip-info\">\n                          <i className=\"video-icon\">🎬</i>\n                        </span>\n                      )}\n                    </div>\n                  </li>\n                ))}\n              </ol>\n            ) : (\n              <div className=\"empty-log\">尚未开始对话</div>\n            )}\n          </div>\n        </div>\n\n        {/* 右侧：视频预览区域 */}\n        <div className=\"game-video-preview\">\n          {isConfirmMode && (\n            <div className=\"confirm-section\">\n              <div className=\"selected-sentence\">\n                <div className=\"selected-text\">{selectedOption?.text}</div>\n                <div className=\"selected-info\">\n                  <span className=\"episode\">{formatEpisode(selectedOption?.episode)}</span>\n                  <span className=\"time\">{formatTime(selectedOption?.start_seconds)}</span>\n                </div>\n              </div>\n              \n              <div className=\"video-preview\">\n                {isVideoLoading ? (\n                  <div className=\"loading-video\">生成视频片段中，请稍候...</div>\n                ) : videoUrl ? (\n                  <video \n                    controls \n                    autoPlay \n                    className=\"video-element\"\n                    src={videoUrl}\n                  />\n                ) : (\n                  <div className=\"video-placeholder\">准备生成视频片段...</div>\n                )}\n              </div>\n              \n              <div className=\"confirm-buttons\">\n                <button \n                  className=\"confirm-btn\"\n                  onClick={gameStarted ? confirmNextSentence : confirmStartSentence}\n                  disabled={isVideoLoading || !videoUrl}\n                >\n                  确认选择\n                </button>\n                <button \n                  className=\"cancel-btn\"\n                  onClick={cancelSelection}\n                >\n                  取消选择\n                </button>\n              </div>\n            </div>\n          )}\n          {!isConfirmMode && (\n            <div className=\"video-section\">\n              <h2>视频预览</h2>\n              {isVideoLoading ? (\n                <div className=\"loading-video\">生成视频片段中，请稍候...</div>\n              ) : videoUrl ? (\n                <video \n                  controls \n                  autoPlay \n                  className=\"video-element\"\n                  src={videoUrl}\n                />\n              ) : (\n                <div className=\"video-placeholder large\">\n                  <div className=\"placeholder-text\">\n                    <p>请从左侧选择一个句子</p>\n                    <p>选择后将在此处预览视频</p>\n                  </div>\n                </div>\n              )}\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nfunction App() {\n  const [query, setQuery] = useState('');\n  const [results, setResults] = useState([]);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState('');\n  const [selectedResult, setSelectedResult] = useState(null);\n  const [videoUrl, setVideoUrl] = useState('');\n  const [apiStatus, setApiStatus] = useState({loading: true, error: null, data: null});\n  const [activePage, setActivePage] = useState('search'); // 'search' 或 'chain-game' or 'rhyme-game' or 'dialogue-game'\n  \n  // API 相关配置\n  const API_BASE_URL = 'http://localhost:8089';\n  \n  // 检查API状态\n  useEffect(() => {\n    const checkApiStatus = async () => {\n      try {\n        const response = await fetch(`${API_BASE_URL}/api/status`);\n        \n        if (response.ok) {\n          const data = await response.json();\n          setApiStatus({loading: false, error: null, data});\n          console.log(\"API状态:\", data);\n        } else {\n          setApiStatus({loading: false, error: '无法连接到API服务', data: null});\n        }\n      } catch (error) {\n        console.error(\"API连接错误:\", error);\n        setApiStatus({loading: false, error: '无法连接到API服务', data: null});\n      }\n    };\n    \n    checkApiStatus();\n  }, []);\n  \n  const handleSearch = async (e) => {\n    e.preventDefault();\n    if (!query.trim()) {\n      setError('请输入搜索内容');\n      return;\n    }\n    \n    setLoading(true);\n    setError('');\n    setResults([]);\n    setSelectedResult(null);\n    setVideoUrl('');\n    \n    try {\n      // 构建查询URL\n      const queryParams = new URLSearchParams({\n        query: query.trim()\n      }).toString();\n      \n      const response = await fetch(`${API_BASE_URL}/api/search?${queryParams}`);\n      \n      if (response.ok) {\n        const data = await response.json();\n        setResults(data.results || []);\n        if (data.results && data.results.length === 0) {\n          setError('没有找到匹配的结果');\n        }\n      } else {\n        const errorData = await response.json();\n        setError(errorData.error || '搜索失败');\n      }\n    } catch (error) {\n      console.error('搜索失败:', error);\n      setError('搜索请求失败，请检查网络连接');\n    } finally {\n      setLoading(false);\n    }\n  };\n  \n  const handleGenerateClip = async (result) => {\n    if (!result) return;\n    \n    setSelectedResult(result);\n    setLoading(true);\n    setError('');\n    setVideoUrl('');\n    \n    try {\n      const response = await fetch(`${API_BASE_URL}/api/generate_clip`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          episode: result.episode,\n          start_time: result.start_seconds,\n          end_time: result.end_seconds,\n          context_seconds: 3 // 上下文秒数\n        })\n      });\n      \n      if (response.ok) {\n        const data = await response.json();\n        if (data.success) {\n          // 确保视频URL包含完整的基础URL\n          const fullVideoUrl = data.video_url.startsWith('http') \n            ? data.video_url \n            : `${API_BASE_URL}${data.video_url}`;\n          setVideoUrl(fullVideoUrl);\n        } else {\n          setError(data.error || '视频片段生成失败');\n        }\n      } else {\n        const errorData = await response.json();\n        setError(errorData.error || '请求失败');\n      }\n    } catch (error) {\n      console.error('生成视频片段失败:', error);\n      setError('请求失败，请检查网络连接');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // 格式化时间显示\n  const formatTime = (seconds) => {\n    if (seconds === undefined || seconds === null) return '00:00:00';\n    const hours = Math.floor(seconds / 3600);\n    const mins = Math.floor((seconds % 3600) / 60);\n    const secs = Math.floor(seconds % 60);\n    return `${hours.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\n  };\n\n  // 格式化集数显示\n  const formatEpisode = (episode) => {\n    if (!episode) return '';\n    return episode.replace('后宫·甄嬛传', '第') + '集';\n  };\n\n  // 高亮显示匹配文本\n  const highlightText = (text, query) => {\n    if (!query || !text) return text;\n    \n    try {\n      const regex = new RegExp(query, 'gi');\n      return text.replace(regex, match => `<mark>${match}</mark>`);\n    } catch (e) {\n      return text;\n    }\n  };\n\n  // 切换页面\n  const switchPage = (page) => {\n    setActivePage(page);\n  };\n\n  return (\n    <div className=\"App\">\n      <header className=\"App-header\">\n        <h1>字幕查询与视频生成系统</h1>\n        \n        <div className={`api-status ${apiStatus.loading ? 'checking' : apiStatus.error ? 'error' : 'connected'}`}>\n          {apiStatus.loading ? '检查API连接中...' : apiStatus.error ? '无法连接到API服务，请确保后端服务已启动' : apiStatus.data ? `API服务已连接 (已加载 ${apiStatus.data.loaded_episodes} 集, ${apiStatus.data.total_subtitles} 条字幕)` : 'API状态未知'}\n        </div>\n        \n        <nav className=\"main-nav\">\n          <ul>\n            <li className={activePage === 'search' ? 'active' : ''}>\n              <button onClick={() => switchPage('search')}>字幕搜索</button>\n            </li>\n            <li className={activePage === 'chain-game' ? 'active' : ''}>\n              <button onClick={() => switchPage('chain-game')}>字幕接龙</button>\n            </li>\n            <li className={activePage === 'rhyme-game' ? 'active' : ''}>\n              <button onClick={() => switchPage('rhyme-game')}>字幕押韵</button>\n            </li>\n            <li className={activePage === 'dialogue-game' ? 'active' : ''}>\n              <button onClick={() => switchPage('dialogue-game')}>奇妙对话</button>\n            </li>\n          </ul>\n        </nav>\n      </header>\n      \n      <main className=\"App-main\">\n        {activePage === 'search' && (\n          <SearchPage \n            API_BASE_URL={API_BASE_URL}\n            query={query}\n            setQuery={setQuery}\n            searchResults={results}\n            setSearchResults={setResults}\n            loading={loading}\n            setLoading={setLoading}\n            apiStatus={apiStatus.loading ? 'checking' : apiStatus.error ? 'error' : 'connected'}\n            error={error}\n            setError={setError}\n            selectedResult={selectedResult}\n            setSelectedResult={setSelectedResult}\n            videoUrl={videoUrl}\n            setVideoUrl={setVideoUrl}\n            isVideoLoading={loading}\n            setIsVideoLoading={setLoading}\n            handleSearch={handleSearch}\n            handleGenerateClip={handleGenerateClip}\n            formatTime={formatTime}\n            formatEpisode={formatEpisode}\n            highlightText={highlightText}\n          />\n        )}\n        \n        {activePage === 'chain-game' && (\n          <ChainGamePage \n            API_BASE_URL={API_BASE_URL}\n            apiStatus={apiStatus.loading ? 'checking' : apiStatus.error ? 'error' : 'connected'}\n            formatTime={formatTime}\n            formatEpisode={formatEpisode}\n          />\n        )}\n        \n        {activePage === 'rhyme-game' && (\n          <RhymeGamePage \n            API_BASE_URL={API_BASE_URL}\n            apiStatus={apiStatus.loading ? 'checking' : apiStatus.error ? 'error' : 'connected'}\n            formatTime={formatTime}\n            formatEpisode={formatEpisode}\n          />\n        )}\n        \n        {activePage === 'dialogue-game' && (\n          <DialogueGamePage \n            API_BASE_URL={API_BASE_URL}\n            apiStatus={apiStatus.loading ? 'checking' : apiStatus.error ? 'error' : 'connected'}\n            formatTime={formatTime}\n            formatEpisode={formatEpisode}\n          />\n        )}\n      </main>\n      \n      <footer className=\"App-footer\">\n        <p>字幕数据来源于《后宫·甄嬛传》</p>\n      </footer>\n    </div>\n  );\n}\n\nexport default App; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}